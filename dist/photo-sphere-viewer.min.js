/*!
* Photo Sphere Viewer 4.0.0-alpha.1
* @copyright 2014-2015 Jérémy Heleine
* @copyright 2015-2018 Damien "Mistic" Sorel
* @licence MIT (https://opensource.org/licenses/MIT)
*/
(function(t,e){typeof exports==="object"&&typeof module!=="undefined"?module.exports=e(require("three"),require("uevent")):typeof define==="function"&&define.amd?define(["three","uevent"],e):t.PhotoSphereViewer=e(t.THREE,t.uEvent)})(this,function(f,t){"use strict";function v(t){this.message=t;if("captureStackTrace"in Error){Error.captureStackTrace(this,v)}else{this.stack=(new Error).stack}}v.prototype=Object.create(Error.prototype);v.prototype.name="PSVError";v.prototype.constructor=v;function c(t,e,i){if(!t.classList){var o=t.getAttribute("class")||"";var n=o.indexOf(e)!==-1;var r=new RegExp("(?:^|\\s)"+e+"(?:\\s|$)");if((i===undefined||i)&&!n){o+=o.length>0?" "+e:e}else if(!i){o=o.replace(r," ")}t.setAttribute("class",o)}else if(i===undefined){t.classList.toggle(e)}else if(i&&!t.classList.contains(e)){t.classList.add(e)}else if(!i){t.classList.remove(e)}}function p(e,t){if(t){t.split(" ").forEach(function(t){c(e,t,true)})}}function n(e,t){if(t){t.split(" ").forEach(function(t){c(e,t,false)})}}function o(t,e){var i=t;do{if(i===e){return true}i=i.parentNode}while(i);return false}function r(t,e){var i=t.matches||t.msMatchesSelector;var o=t;do{if(i.bind(o)(e)){return o}o=o instanceof SVGElement?o.parentNode:o.parentElement}while(o);return null}var i={13:"Enter",27:"Escape",32:" ",33:"PageUp",34:"PageDown",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",46:"Delete",107:"+",109:"-"};var s={Add:"+",Del:"Delete",Down:"ArrowDown",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Spacebar:" ",Subtract:"-",Up:"ArrowUp"};function a(t){var e=t.key||i[t.keyCode||t.which];if(e&&s[e]){e=s[e]}return e}function l(t,e,i){return Math.max(e,Math.min(i,t))}function h(t){if(Number.isInteger){return Number.isInteger(t)}return typeof t==="number"&&Number.isFinite(t)&&Math.floor(t)===t}function g(t){return t.reduce(function(t,e){return t+e},0)}function u(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function d(t){return t.replace(/[A-Z](?:(?=[^A-Z])|[A-Z]*(?=[A-Z][^A-Z]|$))/g,function(t,e){return(e>0?"-":"")+t.toLowerCase()})}function m(t,e){var i=t.match("<GPano:"+e+">(.*)</GPano:"+e+">");if(i!==null){return i[1]}i=t.match("GPano:"+e+'="(.*?)"');if(i!==null){return i[1]}return null}function w(t){return(document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement)===t}function e(t){(t.requestFullscreen||t.mozRequestFullScreen||t.webkitRequestFullscreen||t.msRequestFullscreen).call(t)}function y(){(document.exitFullscreen||document.mozCancelFullScreen||document.webkitExitFullscreen||document.msExitFullscreen).call(document)}function _(t,e){return window.getComputedStyle(t,null)[e]}function E(o,n){var t=[0,Math.PI*2,-Math.PI*2];return t.reduce(function(t,e){var i=n-o+e;return Math.abs(i)<Math.abs(t)?i:t},Infinity)}function b(t,e){return Math.acos(Math.cos(t.latitude)*Math.cos(e.latitude)*Math.cos(t.longitude-e.longitude)+Math.sin(t.latitude)*Math.sin(e.latitude))}var T={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"};function M(t){if(!t){return{x:.5,y:.5}}if(typeof t==="object"){return t}var e=t.toLocaleLowerCase().split(" ").slice(0,2);if(e.length===1){if(T[e[0]]!==undefined){e=[e[0],"center"]}else{e=[e[0],e[0]]}}var i=e[1]!=="left"&&e[1]!=="right"&&e[0]!=="top"&&e[0]!=="bottom";e=e.map(function(t){return T[t]||t});if(!i){e.reverse()}var o=e.join(" ").match(/^([0-9.]+)% ([0-9.]+)%$/);if(o){return{x:parseFloat(o[1])/100,y:parseFloat(o[2])/100}}else{return{x:.5,y:.5}}}function C(t){var e;if(typeof t==="string"){var i=t.toString().trim();var o=parseFloat(i.replace(/^(-?[0-9]+(?:\.[0-9]*)?).*$/,"$1"));var n=i.replace(/^-?[0-9]+(?:\.[0-9]*)?(.*)$/,"$1").trim();if(n.match(/(pm|per minute)$/)){o/=60}switch(n){case"dpm":case"degrees per minute":case"dps":case"degrees per second":e=f.Math.degToRad(o);break;case"rdpm":case"radians per minute":case"rdps":case"radians per second":e=o;break;case"rpm":case"revolutions per minute":case"rps":case"revolutions per second":e=o*Math.PI*2;break;default:throw new v('unknown speed unit "'+n+'"')}}else{e=t}return e}function k(t,e){if(e===void 0){e=false}var i;if(typeof t==="string"){var o=t.toLowerCase().trim().match(/^(-?[0-9]+(?:\.[0-9]*)?)(.*)$/);if(!o){throw new v('unknown angle "'+t+'"')}var n=parseFloat(o[1]);var r=o[2];if(r){switch(r){case"deg":case"degs":i=f.Math.degToRad(n);break;case"rad":case"rads":i=n;break;default:throw new v('unknown angle unit "'+r+'"')}}else{i=n}}else if(typeof t==="number"&&!Number.isNaN(t)){i=t}else{throw new v('unknown angle "'+t+'"')}i=(e?i+Math.PI:i)%(Math.PI*2);if(i<0){i=Math.PI*2+i}return e?l(i-Math.PI,-Math.PI/2,Math.PI/2):i}function x(e){e.traverse(function(t){if(t.geometry){t.geometry.dispose()}if(t.material){if(Array.isArray(t.material)){t.material.forEach(function(t){if(t.map){t.map.dispose()}t.dispose()})}else{if(t.material.map){t.material.map.dispose()}t.material.dispose()}}if(t.dispose){t.dispose()}if(t!==e){x(t)}})}function R(i,o){var n,r,s;var a;var l=0;var h=function t(){l=Date.now();a=undefined;s=i.apply(n,r);if(!a){n=r=null}};return function(){var t=Date.now();if(!l){l=t}var e=o-(t-l);n=this;r=arguments;if(e<=0||e>o){if(a){clearTimeout(a);a=undefined}l=t;s=i.apply(n,r);if(!a){n=r=null}}else if(!a){a=setTimeout(h,e)}return s}}function A(t){if(typeof t==="object"&&t!==null){if(typeof Object.getPrototypeOf==="function"){var e=Object.getPrototypeOf(t);return e===Object.prototype||e===null}return Object.prototype.toString.call(t)==="[object Object]"}return false}function L(t,e){var n=e;return function i(o,e){if(Array.isArray(e)){if(!o||!Array.isArray(o)){o=[]}else{o.length=0}e.forEach(function(t,e){o[e]=i(null,t)})}else if(typeof e==="object"){if(!o||Array.isArray(o)){o={}}Object.keys(e).forEach(function(t){if(typeof e[t]!=="object"||!e[t]||!A(e[t])){o[t]=e[t]}else if(e[t]!=n){if(!o[t]){o[t]=i(null,e[t])}else{i(o[t],e[t])}}})}else{o=e}return o}(t,e)}function S(t){return L(null,t)}function P(t){var e=10;var i=40;var o=800;var n=0;var r=0;var s=0;var a=0;if("detail"in t){r=t.detail}if("wheelDelta"in t){r=-t.wheelDelta/120}if("wheelDeltaY"in t){r=-t.wheelDeltaY/120}if("wheelDeltaX"in t){n=-t.wheelDeltaX/120}if("axis"in t&&t.axis===t.HORIZONTAL_AXIS){n=r;r=0}s=n*e;a=r*e;if("deltaY"in t){a=t.deltaY}if("deltaX"in t){s=t.deltaX}if((s||a)&&t.deltaMode){if(t.deltaMode===1){s*=i;a*=i}else{s*=o;a*=o}}if(s&&!n){n=s<1?-1:1}if(a&&!r){r=a<1?-1:1}return{spinX:n,spinY:r,pixelX:s,pixelY:a}}function O(e,i){Object.keys(e).forEach(function(t){i(e[t],t)})}function z(t,e){return t.filter(function(t){return e.indexOf(t)!==-1})}function D(t){console.warn("PhotoSphereViewer: "+t+".")}var N=Object.freeze({toggleClass:c,addClasses:p,removeClasses:n,hasParent:o,getClosest:r,getEventKey:a,bound:l,isInteger:h,sum:g,distance:u,dasherize:d,getXMPValue:m,isFullscreenEnabled:w,requestFullscreen:e,exitFullscreen:y,getStyle:_,getShortestArc:E,getAngle:b,parsePosition:M,parseSpeed:C,parseAngle:k,cleanTHREEScene:x,throttle:R,isPlainObject:A,deepmerge:L,clone:S,normalizeWheel:P,each:O,intersect:z,logWarn:D});var I="http://www.w3.org/2000/svg";var H=4;var F=.003;var U=300;var V=300;var W=100;var G=64;var Y=8;var X=[0,2,4,5,3,1];var Z=["left","right","top","bottom","back","front"];var j="psvMarker";var $="photoSphereViewer";var B={ROTATE_LAT_UP:"rotateLatitudeUp",ROTATE_LAT_DOWN:"rotateLatitudeDown",ROTATE_LONG_RIGHT:"rotateLongitudeRight",ROTATE_LONG_LEFT:"rotateLongitudeLeft",ZOOM_IN:"zoomIn",ZOOM_OUT:"zoomOut",TOGGLE_AUTOROTATE:"toggleAutorotate"};var K={AUTOROTATE:"autorotate",BEFORE_RENDER:"before-render",CLICK:"click",CLOSE_PANEL:"close-panel",DOUBLE_CLICK:"dblclick",FULLSCREEN_UPDATED:"fullscreen-updated",GOTO_MARKER_DONE:"goto-marker-done",GYROSCOPE_UPDATED:"gyroscope-updated",HIDE_NOTIFICATION:"hide-notification",HIDE_OVERLAY:"hide-overlay",HIDE_TOOLTIP:"hide-tooltip",LEAVE_MARKER:"leave-marker",OPEN_PANEL:"open-panel",OVER_MARKER:"over-marker",PANORAMA_CACHED:"panorama-cached",PANORAMA_LOAD_PROGRESS:"panorama-load-progress",PANORAMA_LOADED:"panorama-loaded",POSITION_UPDATED:"position-updated",READY:"ready",RENDER:"render",RENDER_MARKERS_LIST:"render-markers-list",SELECT_MARKER:"select-marker",SELECT_MARKER_LIST:"select-marker-list",SHOW_NOTIFICATION:"show-notification",SHOW_OVERLAY:"show-overlay",SHOW_TOOLTIP:"show-tooltip",SIZE_UPDATED:"size-updated",STEREO_UPATED:"stereo-updated",UNSELECT_MARKER:"unselect-marker",ZOOM_UPDATED:"zoom-updated"};var q={image:"image",html:"html",polygonPx:"polygonPx",polygonRad:"polygonRad",polylinePx:"polylinePx",polylineRad:"polylineRad",square:"square",rect:"rect",circle:"circle",ellipse:"ellipse",path:"path"};var Q={MARKERS_LIST:"markersList",MARKER:"marker",PLEASE_ROTATE:"pleaseRotate",TWO_FINGERS:"twoFingers",ERROR:"error"};var J={linear:function t(e){return e},inQuad:function t(e){return e*e},outQuad:function t(e){return e*(2-e)},inOutQuad:function t(e){return e<.5?2*e*e:-1+(4-2*e)*e},inCubic:function t(e){return e*e*e},outCubic:function t(e){return--e*e*e+1},inOutCubic:function t(e){return e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1},inQuart:function t(e){return e*e*e*e},outQuart:function t(e){return 1- --e*e*e*e},inOutQuart:function t(e){return e<.5?8*e*e*e*e:1-8*--e*e*e*e},inQuint:function t(e){return e*e*e*e*e},outQuint:function t(e){return 1+--e*e*e*e*e},inOutQuint:function t(e){return e<.5?16*e*e*e*e*e:1+16*--e*e*e*e*e},inSine:function t(e){return 1-Math.cos(e*(Math.PI/2))},outSine:function t(e){return Math.sin(e*(Math.PI/2))},inOutSine:function t(e){return.5-.5*Math.cos(Math.PI*e)},inExpo:function t(e){return Math.pow(2,10*(e-1))},outExpo:function t(e){return 1-Math.pow(2,-10*e)},inOutExpo:function t(e){e=e*2-1;return e<0?.5*Math.pow(2,10*e):1-.5*Math.pow(2,-10*e)},inCirc:function t(e){return 1-Math.sqrt(1-e*e)},outCirc:function t(e){return Math.sqrt(1-(e-1)*(e-1))},inOutCirc:function t(e){e*=2;return e<1?.5-.5*Math.sqrt(1-e*e):.5+.5*Math.sqrt(1-(e-=2)*e)}};var tt=Object.freeze({SVG_NS:I,MOVE_THRESHOLD:H,ANGLE_THRESHOLD:F,DBLCLICK_DELAY:U,INERTIA_WINDOW:V,SPHERE_RADIUS:W,SPHERE_VERTICES:G,CUBE_VERTICES:Y,CUBE_MAP:X,CUBE_HASHMAP:Z,MARKER_DATA:j,VIEWER_DATA:$,ACTIONS:B,EVENTS:K,MARKER_TYPES:q,IDS:Q,EASINGS:J});var et={loaded:false,checkTHREE:it,pixelRatio:1,isWebGLSupported:false,isCanvasSupported:false,isDeviceOrientationSupported:null,isTouchEnabled:null,maxTextureWidth:0,mouseWheelEvent:null,fullscreenEvent:null};et.load=function(){if(!et.loaded){et.loaded=true;et.pixelRatio=window.devicePixelRatio||1;et.isWebGLSupported=rt();et.isCanvasSupported=ot();et.isDeviceOrientationSupported=st();et.isTouchEnabled=at();et.maxTextureWidth=et.isWebGLSupported?lt():4096;et.mouseWheelEvent=ht();et.fullscreenEvent=ut()}};function it(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++){e[i]=arguments[i]}return!e.some(function(t){return!(t in f)})}function ot(){var t=document.createElement("canvas");return!!(t.getContext&&t.getContext("2d"))}function nt(){var e=document.createElement("canvas");var t=["webgl","experimental-webgl","moz-webgl","webkit-3d"];var i=null;if(!e.getContext){return null}if(t.some(function(t){try{i=e.getContext(t);return true}catch(t){return false}})){return i}else{return null}}function rt(){return"WebGLRenderingContext"in window&&nt()!==null}function st(){return new Promise(function(i){if("DeviceOrientationEvent"in window){var t=function t(e){if(e&&e.alpha!==null&&!isNaN(e.alpha)){i(true)}else{i(false)}window.removeEventListener("deviceorientation",t)};window.addEventListener("deviceorientation",t,false);setTimeout(t,2e3)}else{i(false)}})}function at(){return new Promise(function(i){var t=function t(e){if(e){i(true)}else{i(false)}window.removeEventListener("touchstart",t)};window.addEventListener("touchstart",t,false);setTimeout(t,1e4)})}function lt(){var t=nt();if(t!==null){return t.getParameter(t.MAX_TEXTURE_SIZE)}else{return 0}}function ht(){if("onwheel"in document.createElement("div")){return"wheel"}else if(document.onmousewheel!==undefined){return"mousewheel"}else{return"DOMMouseScroll"}}var ct={exitFullscreen:"fullscreenchange",webkitExitFullscreen:"webkitfullscreenchange",mozCancelFullScreen:"mozfullscreenchange",msExitFullscreen:"MSFullscreenChange"};function ut(){var t=Object.keys(ct).filter(function(t){return t in document});if(t.length){return ct[t[0]]}else{return null}}var pt={panorama:null,container:null,caption:null,loadingImg:null,loadingTxt:"Loading...",size:null,fisheye:false,minFov:30,maxFov:90,defaultZoomLvl:50,defaultLong:0,defaultLat:0,sphereCorrection:{pan:0,tilt:0,roll:0},longitudeRange:null,latitudeRange:null,moveSpeed:1,zoomSpeed:2,autorotateStartup:true,autorotateDelay:2e3,autorotateSpeed:"2rpm",autorotateLat:null,transitionDuration:1500,transitionLoader:true,moveInertia:true,mousewheel:true,mousewheelFactor:1,mousemove:true,mousemoveHover:false,touchmoveTwoFingers:false,clickEventOnMarker:false,webgl:true,useXmpData:true,panoData:null,withCredentials:false,cacheTexture:0,navbar:["autorotate","zoom","download","markers","caption","gyroscope","stereo","fullscreen"],lang:{autorotate:"Automatic rotation",zoom:"Zoom",zoomOut:"Zoom out",zoomIn:"Zoom in",download:"Download",fullscreen:"Fullscreen",markers:"Markers",gyroscope:"Gyroscope",stereo:"Stereo view",stereoNotification:"Click anywhere to exit stereo view.",pleaseRotate:["Please rotate your device","(or tap to continue)"],twoFingers:["Use two fingers to navigate"]},keyboard:{ArrowUp:B.ROTATE_LAT_UP,ArrowDown:B.ROTATE_LAT_DOWN,ArrowRight:B.ROTATE_LONG_RIGHT,ArrowLeft:B.ROTATE_LONG_LEFT,PageUp:B.ZOOM_IN,PageDown:B.ZOOM_OUT,"+":B.ZOOM_IN,"-":B.ZOOM_OUT," ":B.TOGGLE_AUTOROTATE},templates:{},icons:{},markers:[]};function dt(t){var e=S(pt);L(e,t);if(!e.container){throw new v("No value given for container.")}if(!et.isCanvasSupported){throw new v("Canvas is not supported.")}if((!et.isWebGLSupported||!e.webgl)&&!et.checkTHREE("CanvasRenderer","Projector")){throw new v("Missing Three.js components: CanvasRenderer, Projector.")}if(e.longitudeRange&&e.longitudeRange.length!==2){e.longitudeRange=null;D("longitudeRange must have exactly two elements")}if(e.latitudeRange){if(e.latitudeRange.length!==2){e.latitudeRange=null;D("latitudeRange must have exactly two elements")}else if(e.latitudeRange[0]>e.latitudeRange[1]){e.latitudeRange=[e.latitudeRange[1],e.latitudeRange[0]];D("latitudeRange values must be ordered")}}if(e.maxFov<e.minFov){var i=[e.minFov,e.maxFov];e.maxFov=i[0];e.minFov=i[1];D("maxFov cannot be lower than minFov")}if(e.cacheTexture&&(!h(e.cacheTexture)||e.cacheTexture<0)){e.cacheTexture=0;D("invalid value for cacheTexture")}if(e.navbar===true){e.navbar=S(pt.navbar)}else if(typeof e.navbar==="string"){e.navbar=e.navbar.split(" ")}if(e.keyboard===true){e.keyboard=S(pt.keyboard)}e.minFov=l(e.minFov,1,179);e.maxFov=l(e.maxFov,1,179);e.defaultZoomLvl=l(e.defaultZoomLvl,0,100);e.defaultLong=k(e.defaultLong);e.defaultLat=k(e.defaultLat,true);e.sphereCorrection.pan=k(e.sphereCorrection.pan,true);e.sphereCorrection.tilt=k(e.sphereCorrection.tilt,true);e.sphereCorrection.roll=k(e.sphereCorrection.roll,true);if(e.autorotateLat===null){e.autorotateLat=e.defaultLat}else{e.autorotateLat=k(e.autorotateLat,true)}if(e.longitudeRange){e.longitudeRange=e.longitudeRange.map(function(t){return k(t)})}if(e.latitudeRange){e.latitudeRange=e.latitudeRange.map(function(t){return k(t,true)})}e.animSpeed=C(e.animSpeed);if(e.caption&&!e.navbar){e.navbar=["caption"]}if(e.fisheye===true){e.fisheye=1}else if(e.fisheye===false){e.fisheye=0}return e}var ft=function(t,e){return'\n<div class="psv-markers-list-container">\n  <h1 class="psv-markers-list-title">'+e.config.lang.markers+'</h1>\n  <ul class="psv-markers-list">\n    '+t.map(function(t){return'\n    <li data-psv-marker="'+t.config.id+'" class="psv-markers-list-item '+(t.config.className||"")+'">\n      '+(t.type==="image"?'<img class="psv-markers-list-image" src="'+t.config.image+'"/>':"")+'\n      <p class="psv-markers-list-name">'+t.getListContent()+"</p>\n    </li>\n    "}).join("")+"\n  </ul>\n</div>\n"};var vt={markersList:ft};function gt(e){var i={};Object.keys(vt).forEach(function(t){if(!e||!e[t]){i[t]=vt[t]}else{i[t]=e[t]}});return i}var mt='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><path d="M50 0a50 50 0 1 0 0 100A50 50 0 0 0 50 0zm0 88.81a38.86 38.86 0 0 1-38.81-38.8 38.86 38.86 0 0 1 38.8-38.82A38.86 38.86 0 0 1 88.82 50 38.87 38.87 0 0 1 50 88.81z"/><path d="M72.07 25.9L40.25 41.06 27.92 74.12l31.82-15.18v-.01l12.32-33.03zM57.84 54.4L44.9 42.58l21.1-10.06-8.17 21.9z"/>\x3c!--Created by iconoci from the Noun Project--\x3e</svg>\n';var wt='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><path d="M83.3 35.6h-17V3H32.2v32.6H16.6l33.6 32.7 33-32.7z"/><path d="M83.3 64.2v16.3H16.6V64.2H-.1v32.6H100V64.2H83.3z"/>\x3c!--Created by Michael Zenaty from the Noun Project--\x3e</svg>\n';var yt='<svg xmlns="http://www.w3.org/2000/svg" viewBox="15 15 70 70"><path d="M50,16.2c-18.6,0-33.8,15.1-33.8,33.8S31.4,83.7,50,83.7S83.8,68.6,83.8,50S68.6,16.2,50,16.2z M50,80.2c-16.7,0-30.2-13.6-30.2-30.2S33.3,19.7,50,19.7S80.3,33.3,80.3,50S66.7,80.2,50,80.2z"/><rect x="48" y="31.7" width="4" height="28"/><rect x="48" y="63.2" width="4" height="5"/>\x3c!--Created by Shastry from the Noun Project--\x3e</svg>\n';var _t='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><path d="M100 40H87.1V18.8h-21V6H100zM100 93.2H66V80.3h21.1v-21H100zM34 93.2H0v-34h12.9v21.1h21zM12.9 40H0V6h34v12.9H12.8z"/>\x3c!--Created by Garrett Knoll from the Noun Project--\x3e</svg>\n';var Et='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><path d="M66 7h13v21h21v13H66zM66 60.3h34v12.9H79v21H66zM0 60.3h34v34H21V73.1H0zM21 7h13v34H0V28h21z"/>\x3c!--Created by Garrett Knoll from the Noun Project--\x3e</svg>\n';var bt='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><path d="M33.38 33.2a1.96 1.96 0 0 0 1.5-3.23 10.61 10.61 0 0 1 7.18-17.51c.7-.06 1.31-.49 1.61-1.12a13.02 13.02 0 0 1 11.74-7.43c7.14 0 12.96 5.8 12.96 12.9 0 3.07-1.1 6.05-3.1 8.38-.7.82-.61 2.05.21 2.76.83.7 2.07.6 2.78-.22a16.77 16.77 0 0 0 4.04-10.91C72.3 7.54 64.72 0 55.4 0a16.98 16.98 0 0 0-14.79 8.7 14.6 14.6 0 0 0-12.23 14.36c0 3.46 1.25 6.82 3.5 9.45.4.45.94.69 1.5.69m45.74 43.55a22.13 22.13 0 0 1-5.23 12.4c-4 4.55-9.53 6.86-16.42 6.86-12.6 0-20.1-10.8-20.17-10.91a1.82 1.82 0 0 0-.08-.1c-5.3-6.83-14.55-23.82-17.27-28.87-.05-.1 0-.21.02-.23a6.3 6.3 0 0 1 8.24 1.85l9.38 12.59a1.97 1.97 0 0 0 3.54-1.17V25.34a4 4 0 0 1 1.19-2.87 3.32 3.32 0 0 1 2.4-.95c1.88.05 3.4 1.82 3.4 3.94v24.32a1.96 1.96 0 0 0 3.93 0v-33.1a3.5 3.5 0 0 1 7 0v35.39a1.96 1.96 0 0 0 3.93 0v-.44c.05-2.05 1.6-3.7 3.49-3.7 1.93 0 3.5 1.7 3.5 3.82v5.63c0 .24.04.48.13.71l.1.26a1.97 1.97 0 0 0 3.76-.37c.33-1.78 1.77-3.07 3.43-3.07 1.9 0 3.45 1.67 3.5 3.74l-1.77 18.1zM77.39 51c-1.25 0-2.45.32-3.5.9v-.15c0-4.27-3.33-7.74-7.42-7.74-1.26 0-2.45.33-3.5.9V16.69a7.42 7.42 0 0 0-14.85 0v1.86a7 7 0 0 0-3.28-.94 7.21 7.21 0 0 0-5.26 2.07 7.92 7.92 0 0 0-2.38 5.67v37.9l-5.83-7.82a10.2 10.2 0 0 0-13.35-2.92 4.1 4.1 0 0 0-1.53 5.48C20 64.52 28.74 80.45 34.07 87.34c.72 1.04 9.02 12.59 23.4 12.59 7.96 0 14.66-2.84 19.38-8.2a26.06 26.06 0 0 0 6.18-14.6l1.78-18.2v-.2c0-4.26-3.32-7.73-7.42-7.73z" fill="#000" fill-rule="evenodd"/>\x3c!--Created by AomAm from the Noun Project--\x3e</svg>\n';var Tt='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64"><path d="M28.3 26.1c-1 2.6-1.9 4.8-2.6 7-2.5 7.4-5 14.7-7.2 22-1.3 4.4.5 7.2 4.3 7.8 1.3.2 2.8.2 4.2-.1 8.2-2 11.9-8.6 15.7-15.2l-2.2 2a18.8 18.8 0 0 1-7.4 5.2 2 2 0 0 1-1.6-.2c-.2-.1 0-1 0-1.4l.8-1.8L41.9 28c.5-1.4.9-3 .7-4.4-.2-2.6-3-4.4-6.3-4.4-8.8.2-15 4.5-19.5 11.8-.2.3-.2.6-.3 1.3 3.7-2.8 6.8-6.1 11.8-6.2z"/><circle cx="39.3" cy="9.2" r="8.2"/>\x3c!--Created by Arafat Uddin from the Noun Project--\x3e</svg>';var Mt='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><path d="M66.7 19a14 14 0 0 1 13.8 12.1l-3.9-2.7c-.5-.3-1.1-.2-1.4.3-.3.5-.2 1.1.3 1.4l5.7 3.9.6.2c.3 0 .6-.2.8-.4l3.9-5.7c.3-.5.2-1.1-.3-1.4-.5-.3-1.1-.2-1.4.3l-2.4 3.5A16 16 0 0 0 66.7 17c-.6 0-1 .4-1 1s.4 1 1 1zM25 15h10c.6 0 1-.4 1-1s-.4-1-1-1H25c-.6 0-1 .4-1 1s.4 1 1 1zm-6.9 30H16l-2 .2a1 1 0 0 0-.8 1.2c.1.5.5.8 1 .8h.2l1.7-.2h2.1c.6 0 1-.4 1-1s-.5-1-1.1-1zm10 0h-4c-.6 0-1 .4-1 1s.4 1 1 1h4c.6 0 1-.4 1-1s-.4-1-1-1zM84 45H55V16A11 11 0 0 0 44 5H16A11 11 0 0 0 5 16v68a11 11 0 0 0 11 11h68a11 11 0 0 0 11-11V56a11 11 0 0 0-11-11zM16 93c-5 0-9-4-9-9V53.2c.3-.1.6-.3.7-.6a9.8 9.8 0 0 1 2-3c.4-.4.4-1 0-1.4a1 1 0 0 0-1.4 0l-1.2 1.5V16c0-5 4-9 9-9h28c5 0 9 4 9 9v68c0 5-4 9-9 9H16zm77-9c0 5-4 9-9 9H50.3c2.8-2 4.7-5.3 4.7-9V47h29c5 0 9 4 9 9v28zM38.1 45h-4c-.6 0-1 .4-1 1s.4 1 1 1h4c.6 0 1-.4 1-1s-.5-1-1-1zm9.9 0h-4c-.6 0-1 .4-1 1s.4 1 1 1h4c.6 0 1-.4 1-1s-.4-1-1-1zm38 19c-.6 0-1 .4-1 1v10c0 .6.4 1 1 1s1-.4 1-1V65c0-.6-.4-1-1-1z"/>\x3c!--Created by Anthony Bresset from the Noun Project--\x3e</svg>';var Ct='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><path d="M24 0C13.8 0 5.5 8.3 5.5 18.5c0 10.07 17.57 28.64 18.32 29.42a.25.25 0 0 0 .36 0c.75-.78 18.32-19.35 18.32-29.42C42.5 8.3 34.2 0 24 0zm0 7.14a10.35 10.35 0 0 1 0 20.68 10.35 10.35 0 0 1 0-20.68z"/>\x3c!--Created by Daniele Marucci from the Noun Project--\x3e</svg>\n';var kt='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 41 41"><path d="M40.5 14.1c-.1-.1-1.2-.5-2.898-1-.102 0-.202-.1-.202-.2C34.5 6.5 28 2 20.5 2S6.6 6.5 3.7 12.9c0 .1-.1.1-.2.2-1.7.6-2.8 1-2.9 1l-.6.3v12.1l.6.2c.1 0 1.1.399 2.7.899.1 0 .2.101.2.199C6.3 34.4 12.9 39 20.5 39c7.602 0 14.102-4.6 16.9-11.1 0-.102.1-.102.199-.2 1.699-.601 2.699-1 2.801-1l.6-.3V14.3l-.5-.2zM6.701 11.5C9.7 7 14.8 4 20.5 4c5.8 0 10.9 3 13.8 7.5.2.3-.1.6-.399.5-3.799-1-8.799-2-13.6-2-4.7 0-9.5 1-13.2 2-.3.1-.5-.2-.4-.5zM25.1 20.3L18.7 24c-.3.2-.7 0-.7-.5v-7.4c0-.4.4-.6.7-.4l6.399 3.8c.301.1.301.6.001.8zm9.4 8.901A16.421 16.421 0 0 1 20.5 37c-5.9 0-11.1-3.1-14-7.898-.2-.302.1-.602.4-.5 3.9 1 8.9 2.1 13.6 2.1 5 0 9.9-1 13.602-2 .298-.1.5.198.398.499z"/>\x3c!--Created by Nick Bluth from the Noun Project--\x3e</svg>\n';var xt='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 41 41"><path d="M40.5 14.1c-.1-.1-1.2-.5-2.899-1-.101 0-.2-.1-.2-.2C34.5 6.5 28 2 20.5 2S6.6 6.5 3.7 12.9c0 .1-.1.1-.2.2-1.7.6-2.8 1-2.9 1l-.6.3v12.1l.6.2c.1 0 1.1.4 2.7.9.1 0 .2.1.2.199C6.3 34.4 12.9 39 20.5 39c7.601 0 14.101-4.6 16.9-11.1 0-.101.1-.101.2-.2 1.699-.6 2.699-1 2.8-1l.6-.3V14.3l-.5-.2zM20.5 4c5.8 0 10.9 3 13.8 7.5.2.3-.1.6-.399.5-3.8-1-8.8-2-13.6-2-4.7 0-9.5 1-13.2 2-.3.1-.5-.2-.4-.5C9.7 7 14.8 4 20.5 4zm0 33c-5.9 0-11.1-3.1-14-7.899-.2-.301.1-.601.4-.5 3.9 1 8.9 2.1 13.6 2.1 5 0 9.9-1 13.601-2 .3-.1.5.2.399.5A16.422 16.422 0 0 1 20.5 37zm18.601-12.1c0 .1-.101.3-.2.3-2.5.9-10.4 3.6-18.4 3.6-7.1 0-15.6-2.699-18.3-3.6C2.1 25.2 2 25 2 24.9V16c0-.1.1-.3.2-.3 2.6-.9 10.6-3.6 18.2-3.6 7.5 0 15.899 2.7 18.5 3.6.1 0 .2.2.2.3v8.9z"/><path d="M18.7 24l6.4-3.7c.3-.2.3-.7 0-.8l-6.4-3.8c-.3-.2-.7 0-.7.4v7.4c0 .5.4.7.7.5z"/>\x3c!--Created by Nick Bluth from the Noun Project--\x3e</svg>\n';var Rt='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -2 16 16"><path d="M13.104 0H2.896C2.332 0 1 .392 1 .875h14C15 .392 13.668 0 13.104 0zM15 1H1a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h3.534a2 2 0 0 0 1.821-1.172l1.19-2.618a.5.5 0 0 1 .91 0l1.19 2.618A2 2 0 0 0 11.466 11H15a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1zM4 7a2 2 0 1 1 0-4 2 2 0 0 1 0 4zm8 0a2 2 0 1 1 0-4 2 2 0 0 1 0 4z"/>\x3c!--Created by Idevã Batista from the Noun Project--\x3e</svg>\n';var At='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M14.043 12.22a7.738 7.738 0 1 0-1.823 1.822l4.985 4.985c.503.504 1.32.504 1.822 0a1.285 1.285 0 0 0 0-1.822l-4.984-4.985zm-6.305 1.043a5.527 5.527 0 1 1 0-11.053 5.527 5.527 0 0 1 0 11.053z"/><path d="M8.728 4.009H6.744v2.737H4.006V8.73h2.738v2.736h1.984V8.73h2.737V6.746H8.728z"/>\x3c!--Created by Ryan Canning from the Noun Project--\x3e</svg>\n';var Lt='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M14.043 12.22a7.738 7.738 0 1 0-1.823 1.822l4.985 4.985c.503.504 1.32.504 1.822 0a1.285 1.285 0 0 0 0-1.822l-4.984-4.985zm-6.305 1.043a5.527 5.527 0 1 1 0-11.053 5.527 5.527 0 0 1 0 11.053z"/><path d="M4.006 6.746h7.459V8.73H4.006z"/>\x3c!--Created by Ryan Canning from the Noun Project--\x3e</svg>\n';var St={compass:mt,download:wt,error:yt,fullscreenIn:_t,fullscreenOut:Et,gesture:bt,info:Tt,mobileRotate:Mt,pin:Ct,play:xt,playActive:kt,stereo:Rt,zoomIn:At,zoomOut:Lt};function Pt(e){var i={};Object.keys(St).forEach(function(t){if(!e||!e[t]){i[t]=St[t]}else{i[t]=e[t]}});return i}var Ot=function(){function r(t){var i=this;this.__cancelled=false;this.__resolved=false;this.__promise=new Promise(function(t,e){i.__resolve=t;i.__reject=e});if(t){if(!t.easing||typeof t.easing==="string"){t.easing=J[t.easing||"linear"]}this.__start=null;this.options=t;if(t.delay){this.__delayTimeout=setTimeout(function(){i.__delayTimeout=null;window.requestAnimationFrame(function(t){return i.__run(t)})},t.delay)}else{window.requestAnimationFrame(function(t){return i.__run(t)})}}}var t=r.prototype;t.__run=function t(e){var i=this;if(this.__cancelled){return}if(this.__start===null){this.__start=e}var o=(e-this.__start)/this.options.duration;var n={};if(o<1){O(this.options.properties,function(t,e){n[e]=t.start+(t.end-t.start)*i.options.easing(o)});this.options.onTick(n,o);window.requestAnimationFrame(function(t){return i.__run(t)})}else{O(this.options.properties,function(t,e){n[e]=t.end});this.options.onTick(n,1);window.requestAnimationFrame(function(){i.__resolved=true;i.__resolve()})}};t.then=function t(e,i){var o=this;if(e===void 0){e=null}if(i===void 0){i=null}var n=new r;n.__promise.then(null,function(){return o.cancel()});this.__promise.then(function(){return n.__resolve(e?e():undefined)},function(){return n.__reject(i?i():undefined)});return n};t.catch=function t(e){return this.then(undefined,e)};t.finally=function t(e){return this.then(e,e)};t.cancel=function t(){if(!this.__cancelled&&!this.__resolved){this.__cancelled=true;this.__reject();if(this.__delayTimeout){window.cancelAnimationFrame(this.__delayTimeout);this.__delayTimeout=null}}};r.resolve=function t(){var e=Promise.resolve();e.cancel=function(){};return e};return r}();function zt(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||false;o.configurable=true;if("value"in o)o.writable=true;Object.defineProperty(t,o.key,o)}}function Dt(t,e,i){if(e)zt(t.prototype,e);if(i)zt(t,i);return t}function Nt(t,e){t.prototype=Object.create(e.prototype);t.prototype.constructor=t;t.__proto__=e}function It(t){if(t===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t}var Ht=function(){function o(t,e){if(!t.id){throw new v("missing marker id")}if(t.image&&(!t.width||!t.height)){throw new v("missing marker width/height")}if(t.image||t.html){if((!("x"in t)||!("y"in t))&&(!("latitude"in t)||!("longitude"in t))){throw new v("missing marker position, latitude/longitude or x/y")}}this.psv=e;this.id=t.id;this.type=o.getType(t,false);this.visible=true;this.$el=null;this.config={};this.data=undefined;this.props={dynamicSize:false,anchor:null,position:null,position2D:null,positions3D:null,width:null,height:null,def:null};if(this.isNormal()){this.$el=document.createElement("div")}else if(this.isPolygon()){this.$el=document.createElementNS(I,"polygon")}else if(this.isPolyline()){this.$el=document.createElementNS(I,"polyline")}else{this.$el=document.createElementNS(I,this.type)}this.$el.id="psv-marker-"+this.id;this.$el[j]=this;this.update(t)}var t=o.prototype;t.destroy=function t(){delete this.$el[j];delete this.$el;delete this.config;delete this.props;delete this.psv};t.isNormal=function t(){return this.type===q.image||this.type===q.html};t.isPoly=function t(){return this.isPolygon()||this.isPolyline()};t.isPolyPx=function t(){return this.type===q.polygonPx||this.type===q.polylinePx};t.isPolyRad=function t(){return this.type===q.polygonRad||this.type===q.polylineRad};t.isPolygon=function t(){return this.type===q.polygonPx||this.type===q.polygonRad};t.isPolyline=function t(){return this.type===q.polylinePx||this.type===q.polylineRad};t.isSvg=function t(){return this.type===q.square||this.type===q.rect||this.type===q.circle||this.type===q.ellipse||this.type===q.path};t.getScale=function t(e){if(Array.isArray(this.config.scale)){return this.config.scale[0]+(this.config.scale[1]-this.config.scale[0])*J.inQuad(e/100)}else if(typeof this.config.scale==="function"){return this.config.scale(e)}else if(typeof this.config.scale==="number"){return this.config.scale*J.inQuad(e/100)}else{return 1}};t.getListContent=function t(){if(this.config.listContent){return this.config.listContent}else if(this.config.tooltip){return this.config.tooltip.content}else if(this.config.html){return this.config.html}else{return this.id}};t.update=function t(e){if(e&&e!==this.config){var i=o.getType(e,true);if(i!==undefined&&i!==this.type){throw new v("cannot change marker type")}L(this.config,e);this.data=this.config.data;this.visible=e.visible!==false}if(this.isNormal()){this.$el.setAttribute("class","psv-marker psv-marker--normal")}else{this.$el.setAttribute("class","psv-marker psv-marker--svg")}if(this.config.className){p(this.$el,this.config.className)}if(this.config.tooltip){p(this.$el,"psv-marker--has-tooltip");if(typeof this.config.tooltip==="string"){this.config.tooltip={content:this.config.tooltip}}}if(this.config.content){p(this.$el,"psv-marler--has-content")}if(this.config.style){L(this.$el.style,this.config.style)}this.props.anchor=M(this.config.anchor);if(this.isNormal()){this.__updateNormal()}else if(this.isPoly()){this.__updatePoly()}else{this.__updateSvg()}};t.__updateNormal=function t(){if(this.config.width&&this.config.height){this.props.dynamicSize=false;this.props.width=this.config.width;this.props.height=this.config.height;this.$el.style.width=this.config.width+"px";this.$el.style.height=this.config.height+"px"}else{this.props.dynamicSize=true}if(this.config.image){this.props.def=this.config.image;this.$el.style.backgroundImage="url("+this.config.image+")"}else if(this.config.html){this.props.def=this.config.html;this.$el.innerHTML=this.config.html}this.$el.style.transformOrigin=this.props.anchor.x*100+"% "+this.props.anchor.y*100+"%";this.props.position=this.psv.dataHelper.cleanPosition(this.config);this.props.positions3D=[this.psv.dataHelper.sphericalCoordsToVector3(this.props.position)]};t.__updateSvg=function t(){var i=this;this.props.dynamicSize=true;switch(this.type){case q.square:this.props.def={x:0,y:0,width:this.config.square,height:this.config.square};break;case q.rect:if(Array.isArray(this.config.rect)){this.props.def={x:0,y:0,width:this.config.rect[0],height:this.config.rect[1]}}else{this.props.def={x:0,y:0,width:this.config.rect.width,height:this.config.rect.height}}break;case q.circle:this.props.def={cx:this.config.circle,cy:this.config.circle,r:this.config.circle};break;case q.ellipse:if(Array.isArray(this.config.ellipse)){this.props.def={cx:this.config.ellipse[0],cy:this.config.ellipse[1],rx:this.config.ellipse[0],ry:this.config.ellipse[1]}}else{this.props.def={cx:this.config.ellipse.rx,cy:this.config.ellipse.ry,rx:this.config.ellipse.rx,ry:this.config.ellipse.ry}}break;case q.path:this.props.def={d:this.config.path};break}O(this.props.def,function(t,e){i.$el.setAttributeNS(null,e,t)});if(this.config.svgStyle){O(this.config.svgStyle,function(t,e){i.$el.setAttributeNS(null,d(e),t)})}else{this.$el.setAttributeNS(null,"fill","rgba(0,0,0,0.5)")}this.props.position=this.psv.dataHelper.cleanPosition(this.config);this.props.positions3D=[this.psv.dataHelper.sphericalCoordsToVector3(this.props.position)]};t.__updatePoly=function t(){var i=this;this.props.dynamicSize=true;if(this.config.svgStyle){O(this.config.svgStyle,function(t,e){i.$el.setAttributeNS(null,d(e),t)});if(this.isPolyline()&&!this.config.svgStyle.fill){this.$el.setAttributeNS(null,"fill","none")}}else if(this.isPolygon()){this.$el.setAttributeNS(null,"fill","rgba(0,0,0,0.5)")}else if(this.isPolyline()){this.$el.setAttributeNS(null,"fill","none");this.$el.setAttributeNS(null,"stroke","rgb(0,0,0)")}var e=this.config.polygonPx||this.config.polygonRad||this.config.polylinePx||this.config.polylineRad;if(!Array.isArray(e[0])){for(var o=0;o<e.length;o++){e.splice(o,2,[e[o],e[o+1]])}}if(this.isPolyPx()){this.props.def=e.map(function(t){var e=i.psv.dataHelper.textureCoordsToSphericalCoords({x:t[0],y:t[1]});return[e.longitude,e.latitude]})}else{this.props.def=e.map(function(t){return[k(t[0]),k(t[1],true)]})}this.props.position={longitude:this.props.def[0][0],latitude:this.props.def[0][1]};this.props.positions3D=this.props.def.map(function(t){return i.psv.dataHelper.sphericalCoordsToVector3({longitude:t[0],latitude:t[1]})})};o.getType=function t(e,i){if(i===void 0){i=false}var o=[];O(q,function(t){if(t in e){o.push(t)}});if(o.length===0&&!i){throw new v("missing marker content, either "+Object.keys(q).join(", "))}else if(o.length>1){throw new v("multiple marker content, either "+Object.keys(q).join(", "))}return o[0]};return o}();var Ft=function(){function t(t,e){this.psv=t instanceof pe?t:t.psv;this.parent=t;this.visible=true;this.container=document.createElement("div");this.container.className=e;this.parent.container.appendChild(this.container)}var e=t.prototype;e.destroy=function t(){this.parent.container.removeChild(this.container);delete this.container;delete this.parent;delete this.psv};e.hide=function t(){this.container.style.display="none";this.visible=false};e.show=function t(){this.container.style.display="";this.visible=true};e.isVisible=function t(){return this.visible};return t}();var Ut=function(i){Nt(t,i);function t(t){var e;e=i.call(this,t,"psv-hud")||this;e.markers={};e.currentMarker=null;e.hoveringMarker=null;if(e.psv.config.mousemove){e.container.style.cursor="move"}e.svgContainer=document.createElementNS(I,"svg");e.svgContainer.setAttribute("class","psv-hud-svg-container");e.container.appendChild(e.svgContainer);e.container.addEventListener("mouseenter",It(It(e)),true);e.container.addEventListener("mouseleave",It(It(e)),true);e.container.addEventListener("mousemove",It(It(e)),true);e.psv.on(K.CLICK,It(It(e)));e.psv.on(K.DOUBLE_CLICK,It(It(e)));e.psv.on(K.RENDER,It(It(e)));return e}var e=t.prototype;e.destroy=function t(){this.clearMarkers(false);this.container.removeEventListener("mouseenter",this);this.container.removeEventListener("mouseleave",this);this.container.removeEventListener("mousemove",this);this.psv.off(K.CLICK,this);this.psv.off(K.DOUBLE_CLICK,this);this.psv.off(K.RENDER,this);delete this.svgContainer;delete this.currentMarker;delete this.hoveringMarker;delete this.markers;i.prototype.destroy.call(this)};e.handleEvent=function t(e){switch(e.type){case"mouseenter":this.__onMouseEnter(e);break;case"mouseleave":this.__onMouseLeave(e);break;case"mousemove":this.__onMouseMove(e);break;case K.CLICK:this.__onClick(e.args[0],e,false);break;case K.DOUBLE_CLICK:this.__onClick(e.args[0],e,true);break;case K.RENDER:this.renderMarkers();break}};e.addMarker=function t(e,i){if(i===void 0){i=true}if(this.markers[e.id]){throw new v('marker "'+e.id+'" already exists')}var o=new Ht(e,this.psv);if(o.isNormal()){this.container.appendChild(o.$el)}else{this.svgContainer.appendChild(o.$el)}this.markers[o.id]=o;if(i){this.renderMarkers()}return o};e.getMarker=function t(e){var i=typeof e==="object"?e.id:e;if(!this.markers[i]){throw new v('cannot find marker "'+i+'"')}return this.markers[i]};e.getCurrentMarker=function t(){return this.currentMarker};e.updateMarker=function t(e,i){if(i===void 0){i=true}var o=this.getMarker(e);o.update(e);if(i){this.renderMarkers()}return o};e.removeMarker=function t(e){var i=this.getMarker(e);if(i.isNormal()){this.container.removeChild(i.$el)}else{this.svgContainer.removeChild(i.$el)}if(this.hoveringMarker===i){this.psv.tooltip.hide()}i.destroy();delete this.markers[i.id]};e.setMarkers=function t(e,i){var o=this;if(i===void 0){i=true}this.clearMarkers(false);O(e,function(t){return o.addMarker(t,false)});if(i){this.renderMarkers()}};e.clearMarkers=function t(e){var i=this;if(e===void 0){e=true}O(this.markers,function(t){return i.removeMarker(t,false)});if(e){this.renderMarkers()}};e.gotoMarker=function t(e,i){var o=this;var n=this.getMarker(e);return this.psv.animate(n.props.position,i).then(function(){o.psv.trigger(K.GOTO_MARKER_DONE,n)})};e.hideMarker=function t(e){this.getMarker(e).visible=false;this.renderMarkers()};e.showMarker=function t(e){this.getMarker(e).visible=true;this.renderMarkers()};e.toggleMarker=function t(e){this.getMarker(e).visible^=true;this.renderMarkers()};e.renderMarkers=function t(){var l=this;if(!this.visible){return}var h=!this.psv.isGyroscopeEnabled()?0:f.Math.radToDeg(this.psv.renderer.camera.rotation.z);O(this.markers,function(t){var e=t.visible;if(e&&t.isPoly()){var i=l.__getPolyPositions(t);e=i.length>(t.isPolygon()?2:1);if(e){t.props.position2D=l.__getPolyDimensions(t,i);var o=i.map(function(t){return t.x+","+t.y}).join(" ");t.$el.setAttributeNS(null,"points",o)}}else if(e){if(t.props.dynamicSize){l.__updateMarkerSize(t)}var n=t.getScale(l.psv.getZoomLevel());var r=l.__getMarkerPosition(t,n);e=l.__isMarkerVisible(t,r);if(e){t.props.position2D=r;if(t.isSvg()){var s="translate("+r.x+", "+r.y+")";if(n!==1){s+=" scale("+n+", "+n+")"}if(!t.config.lockRotation&&h){s+=" rotate("+h+")"}t.$el.setAttributeNS(null,"transform",s)}else{var a="translate3D("+r.x+"px, "+r.y+"px, 0px)";if(n!==1){a+=" scale("+n+", "+n+")"}if(!t.config.lockRotation&&h){a+=" rotateZ("+h+"deg)"}t.$el.style.transform=a}}}c(t.$el,"psv-marker--visible",e)})};e.__isMarkerVisible=function t(e,i){return e.props.positions3D[0].dot(this.psv.prop.direction)>0&&i.x+e.props.width>=0&&i.x-e.props.width<=this.psv.prop.size.width&&i.y+e.props.height>=0&&i.y-e.props.height<=this.psv.prop.size.height};e.__updateMarkerSize=function t(e){p(e.$el,"psv-marker--transparent");var i;if(e.isSvg()){i=e.$el.getAttributeNS(null,"transform");e.$el.removeAttributeNS(null,"transform")}else{i=e.$el.style.transform;e.$el.style.transform=""}var o=e.$el.getBoundingClientRect();e.props.width=o.right-o.left;e.props.height=o.bottom-o.top;n(e.$el,"psv-marker--transparent");if(i){if(e.isSvg()){e.$el.setAttributeNS(null,"transform",i)}else{e.$el.style.transform=i}}e.props.dynamicSize=false};e.__getMarkerPosition=function t(e,i){var o=this.psv.dataHelper.vector3ToViewerCoords(e.props.positions3D[0]);o.x-=e.props.width*e.props.anchor.x*i;o.y-=e.props.height*e.props.anchor.y*i;return o};e.__getPolyPositions=function t(e){var i=this;var o=e.props.positions3D.length;var n=e.props.positions3D.map(function(t){return{vector:t,visible:t.dot(i.psv.prop.direction)>0}});var r=[];n.forEach(function(e,i){if(!e.visible){var t=[i===0?n[o-1]:n[i-1],i===o-1?n[0]:n[i+1]];t.forEach(function(t){if(t.visible){r.push({visible:t,invisible:e,index:i})}})}});r.reverse().forEach(function(t){n.splice(t.index,0,{vector:i.__getPolyIntermediaryPoint(t.visible.vector,t.invisible.vector),visible:true})});return n.filter(function(t){return t.visible}).map(function(t){return i.psv.dataHelper.vector3ToViewerCoords(t.vector)})};e.__getPolyIntermediaryPoint=function t(e,i){var o=this.psv.prop.direction.clone().normalize();var n=(new f.Vector3).crossVectors(e,i).normalize();var r=(new f.Vector3).crossVectors(n,e).normalize();var s=e.clone().multiplyScalar(-o.dot(r));var a=r.clone().multiplyScalar(o.dot(e));var l=(new f.Vector3).addVectors(s,a).normalize();var h=(new f.Vector3).crossVectors(l,o);return l.applyAxisAngle(h,.01).multiplyScalar(W)};e.__getPolyDimensions=function t(e,i){var o=+Infinity;var n=+Infinity;var r=-Infinity;var s=-Infinity;i.forEach(function(t){o=Math.min(o,t.x);n=Math.min(n,t.y);r=Math.max(r,t.x);s=Math.max(s,t.y)});e.props.width=r-o;e.props.height=s-n;return{x:o,y:n}};e.__getTargetMarker=function t(e,i){if(i===void 0){i=false}var o=i?r(e,".psv-marker"):e;return o?o[j]:undefined};e.__targetOnTooltip=function t(e){return e?o(e,this.psv.tooltip.container):false};e.__onMouseEnter=function t(e){var i=this.__getTargetMarker(e.target);if(i&&!i.isPoly()){this.hoveringMarker=i;this.psv.trigger(K.OVER_MARKER,i);if(i.config.tooltip){this.psv.tooltip.show({content:i.config.tooltip.content,position:i.config.tooltip.position,left:i.props.position2D.x,top:i.props.position2D.y,box:{width:i.props.width,height:i.props.height}})}}};e.__onMouseLeave=function t(e){var i=this.__getTargetMarker(e.target);if(i&&!(i.isPoly()&&this.__targetOnTooltip(e.relatedTarget))){this.psv.trigger(K.LEAVE_MARKER,i);this.hoveringMarker=null;this.psv.tooltip.hide()}};e.__onMouseMove=function t(e){if(!this.psv.eventsHandler.state.moving){var i;var o=this.__getTargetMarker(e.target);if(o&&o.isPoly()){i=o}else if(this.__targetOnTooltip(e.target)&&this.hoveringMarker){i=this.hoveringMarker}if(i){if(!this.hoveringMarker){this.psv.trigger(K.OVER_MARKER,i);this.hoveringMarker=i}var n=this.psv.container.getBoundingClientRect();if(i.config.tooltip){this.psv.tooltip.show({content:i.config.tooltip.content,position:i.config.tooltip.position,top:e.clientY-n.top-this.psv.tooltip.prop.arrowSize/2,left:e.clientX-n.left-this.psv.tooltip.prop.arrowSize,box:{width:this.psv.tooltip.prop.arrowSize*2,height:this.psv.tooltip.prop.arrowSize*2}})}}else if(this.hoveringMarker&&this.hoveringMarker.isPoly()){this.psv.trigger(K.LEAVE_MARKER,this.hoveringMarker);this.hoveringMarker=null;this.psv.tooltip.hide()}}};e.__onClick=function t(e,i,o){var n=this.__getTargetMarker(e.target,true);if(n){this.currentMarker=n;this.psv.trigger(K.SELECT_MARKER,n,o);if(this.psv.config.clickEventOnMarker){e.marker=n}else{i.stopPropagation()}}else if(this.currentMarker){this.psv.trigger(K.UNSELECT_MARKER,this.currentMarker);this.currentMarker=null}if(n&&n.config.content){this.psv.panel.show({id:Q.MARKER,content:n.config.content})}else{this.psv.panel.hide(Q.MARKER)}};return t}(Ft);var Vt=function(n){Nt(t,n);function t(t){var e;e=n.call(this,t,"psv-loader-container")||this;e.loader=document.createElement("div");e.loader.className="psv-loader";e.container.appendChild(e.loader);e.canvas=document.createElement("canvas");e.canvas.className="psv-loader-canvas";e.canvas.width=e.loader.clientWidth*et.pixelRatio;e.canvas.height=e.loader.clientWidth*et.pixelRatio;e.loader.appendChild(e.canvas);e.prop={tickness:(e.loader.offsetWidth-e.loader.clientWidth)/2*et.pixelRatio};var i;if(e.psv.config.loadingImg){i=document.createElement("img");i.className="psv-loader-image";i.src=e.psv.config.loadingImg}else if(e.psv.config.loadingTxt){i=document.createElement("div");i.className="psv-loader-text";i.innerHTML=e.psv.config.loadingTxt}if(i){var o=Math.round(Math.sqrt(2*Math.pow((e.canvas.width/2-e.prop.tickness/2)/et.pixelRatio,2)));i.style.maxWidth=o+"px";i.style.maxHeight=o+"px";e.loader.appendChild(i)}e.hide();return e}var e=t.prototype;e.destroy=function t(){delete this.loader;delete this.canvas;n.prototype.destroy.call(this)};e.setProgress=function t(e){var i=this.canvas.getContext("2d");i.clearRect(0,0,this.canvas.width,this.canvas.height);i.lineWidth=this.prop.tickness;i.strokeStyle=_(this.loader,"color");i.beginPath();i.arc(this.canvas.width/2,this.canvas.height/2,this.canvas.width/2-this.prop.tickness/2,-Math.PI/2,e/100*2*Math.PI-Math.PI/2);i.stroke()};return t}(Ft);var Wt=function(n){Nt(t,n);Dt(t,null,[{key:"id",get:function t(){return null}},{key:"icon",get:function t(){return null}},{key:"iconActive",get:function t(){return null}}]);function t(t,e){var i;i=n.call(this,t,"psv-button "+e)||this;i.id=i.constructor.id;i.enabled=true;if(i.constructor.icon){i.__setIcon(i.constructor.icon)}if(i.id&&i.psv.config.lang[i.id]){i.container.title=i.psv.config.lang[i.id]}i.container.addEventListener("click",function(t){if(i.enabled){i.__onClick()}t.stopPropagation()});var o=i.supported();if(typeof o.then==="function"){i.hide();o.then(function(t){if(t){i.show()}})}else if(!o){i.hide()}return i}var e=t.prototype;e.supported=function t(){return true};e.toggleActive=function t(e){c(this.container,"psv-button--active",e);if(this.constructor.iconActive){this.__setIcon(e?this.constructor.iconActive:this.constructor.icon)}};e.disable=function t(){this.container.classList.add("psv-button--disabled");this.enabled=false};e.enable=function t(){this.container.classList.remove("psv-button--disabled");this.enabled=true};e.__setIcon=function t(e,i){if(i===void 0){i=this.container}if(e){i.innerHTML=this.psv.icons[e];i.querySelector("svg").setAttribute("class","psv-button-svg")}else{i.innerHTML=""}};e.__onClick=function t(){throw new v('__onClick not implemented for button "'+this.id+'".')};return t}(Ft);var Gt=function(i){Nt(t,i);Dt(t,null,[{key:"id",get:function t(){return"autorotate"}},{key:"icon",get:function t(){return"play"}},{key:"iconActive",get:function t(){return"playActive"}}]);function t(t){var e;e=i.call(this,t,"psv-button--hover-scale psv-autorotate-button")||this;e.psv.on(K.AUTOROTATE,It(It(e)));return e}var e=t.prototype;e.destroy=function t(){this.psv.off(K.AUTOROTATE,this);i.prototype.destroy.call(this)};e.handleEvent=function t(e){switch(e.type){case K.AUTOROTATE:this.toggleActive(e.args[0]);break}};e.__onClick=function t(){this.psv.toggleAutorotate()};return t}(Wt);var Yt=function(o){Nt(t,o);function t(t,e){var i;i=o.call(this,t,"psv-custom-button")||this;i.config=e;if(i.config.id){i.id=i.config.id}if(i.config.className){p(i.container,i.config.className)}if(i.config.title){i.container.title=i.config.title}if(i.config.content){i.container.innerHTML=i.config.content}if(i.config.enabled===false){i.disable()}if(i.config.visible===false){i.hide()}return i}var e=t.prototype;e.destroy=function t(){delete this.config;o.prototype.destroy.call(this)};e.__onClick=function t(){if(this.config.onClick){this.config.onClick.apply(this.psv)}};return t}(Wt);var Xt=function(e){Nt(t,e);Dt(t,null,[{key:"id",get:function t(){return"download"}},{key:"icon",get:function t(){return"download"}}]);function t(t){return e.call(this,t,"psv-button--hover-scale psv-download-button")||this}var i=t.prototype;i.__onClick=function t(){var e=this;var i=document.createElement("a");i.href=this.psv.config.panorama;i.download=this.psv.config.panorama;this.psv.container.appendChild(i);i.click();setTimeout(function(){e.psv.container.removeChild(i)},100)};return t}(Wt);var Zt=function(i){Nt(t,i);Dt(t,null,[{key:"id",get:function t(){return"fullscreen"}},{key:"icon",get:function t(){return"fullscreenIn"}},{key:"iconActive",get:function t(){return"fullscreenOut"}}]);function t(t){var e;e=i.call(this,t,"psv-button--hover-scale psv-fullscreen-button")||this;e.psv.on(K.FULLSCREEN_UPDATED,It(It(e)));return e}var e=t.prototype;e.destroy=function t(){this.psv.off(K.FULLSCREEN_UPDATED,this);i.prototype.destroy.call(this)};e.handleEvent=function t(e){switch(e.type){case K.FULLSCREEN_UPDATED:this.toggleActive(e.args[0]);break}};e.__onClick=function t(){this.psv.toggleFullscreen()};return t}(Wt);var jt=function(i){Nt(t,i);Dt(t,null,[{key:"id",get:function t(){return"gyroscope"}},{key:"icon",get:function t(){return"compass"}}]);function t(t){var e;e=i.call(this,t,"psv-button--hover-scale psv-gyroscope-button")||this;e.psv.on(K.GYROSCOPE_UPDATED,It(It(e)));return e}var e=t.prototype;e.destroy=function t(){this.psv.off(K.GYROSCOPE_UPDATED,this);i.prototype.destroy.call(this)};e.supported=function t(){if(!et.checkTHREE("DeviceOrientationControls")){return false}else{return et.isDeviceOrientationSupported}};e.handleEvent=function t(e){switch(e.type){case K.GYROSCOPE_UPDATED:this.toggleActive(e.args[0]);break}};e.__onClick=function t(){this.psv.toggleGyroscopeControl()};return t}(Wt);var $t=function(i){Nt(t,i);Dt(t,null,[{key:"id",get:function t(){return"markers"}},{key:"icon",get:function t(){return"pin"}}]);function t(t){var e;e=i.call(this,t,"psv-button--hover-scale psv-markers-button")||this;e.psv.on(K.OPEN_PANEL,It(It(e)));e.psv.on(K.CLOSE_PANEL,It(It(e)));return e}var e=t.prototype;e.destroy=function t(){this.psv.off(K.OPEN_PANEL,this);this.psv.off(K.CLOSE_PANEL,this);i.prototype.destroy.call(this)};e.handleEvent=function t(e){switch(e.type){case K.OPEN_PANEL:this.toggleActive(e.args[0]===Q.MARKERS_LIST);break;case K.CLOSE_PANEL:this.toggleActive(false);break}};e.__onClick=function t(){this.psv.toggleMarkersList()};return t}(Wt);var Bt=function(i){Nt(t,i);Dt(t,null,[{key:"id",get:function t(){return"stereo"}},{key:"icon",get:function t(){return"stereo"}}]);function t(t){var e;e=i.call(this,t,"psv-button--hover-scale psv-stereo-button")||this;e.psv.on(K.STEREO_UPATED,It(It(e)));return e}var e=t.prototype;e.destroy=function t(){this.psv.off(K.STEREO_UPATED,this);i.prototype.destroy.call(this)};e.supported=function t(){if(!et.checkTHREE("DeviceOrientationControls")){return false}else{return et.isDeviceOrientationSupported}};e.handleEvent=function t(e){switch(e.type){case K.STEREO_UPATED:this.toggleActive(e.args[0]);break}};e.__onClick=function t(){this.psv.toggleStereoView()};return t}(Wt);var Kt=function(r){Nt(t,r);Dt(t,null,[{key:"id",get:function t(){return"zoom"}}]);function t(t){var e;e=r.call(this,t,"psv-zoom-button")||this;e.prop={mousedown:false,buttondown:false,longPressInterval:null,longPressTimeout:null};var i=document.createElement("div");i.className="psv-zoom-button-minus";i.title=e.psv.config.lang.zoomOut;e.__setIcon("zoomOut",i);e.container.appendChild(i);var o=document.createElement("div");o.className="psv-zoom-button-range";e.container.appendChild(o);e.zoomRange=document.createElement("div");e.zoomRange.className="psv-zoom-button-line";o.appendChild(e.zoomRange);e.zoomValue=document.createElement("div");e.zoomValue.className="psv-zoom-button-handle";e.zoomRange.appendChild(e.zoomValue);var n=document.createElement("div");n.className="psv-zoom-button-plus";n.title=e.psv.config.lang.zoomIn;e.__setIcon("zoomIn",n);e.container.appendChild(n);e.zoomRange.addEventListener("mousedown",It(It(e)));e.zoomRange.addEventListener("touchstart",It(It(e)));e.psv.container.addEventListener("mousemove",It(It(e)));e.psv.container.addEventListener("touchmove",It(It(e)));e.psv.container.addEventListener("mouseup",It(It(e)));e.psv.container.addEventListener("touchend",It(It(e)));i.addEventListener("mousedown",e.__zoomOut.bind(It(It(e))));n.addEventListener("mousedown",e.__zoomIn.bind(It(It(e))));e.psv.on(K.ZOOM_UPDATED,It(It(e)));e.psv.once(K.READY,It(It(e)));return e}var e=t.prototype;e.destroy=function t(){this.__stopZoomChange();this.psv.container.removeEventListener("mousemove",this);this.psv.container.removeEventListener("touchmove",this);this.psv.container.removeEventListener("mouseup",this);this.psv.container.removeEventListener("touchend",this);delete this.zoomRange;delete this.zoomValue;delete this.prop;this.psv.off(K.ZOOM_UPDATED,this);r.prototype.destroy.call(this)};e.handleEvent=function t(e){switch(e.type){case"mousedown":this.__initZoomChangeWithMouse(e);break;case"touchstart":this.__initZoomChangeByTouch(e);break;case"mousemove":this.__changeZoomWithMouse(e);break;case"touchmove":this.__changeZoomByTouch(e);break;case"mouseup":this.__stopZoomChange(e);break;case"touchend":this.__stopZoomChange(e);break;case K.ZOOM_UPDATED:this.__moveZoomValue(e.args[0]);break;case K.READY:this.__moveZoomValue(this.psv.prop.zoomLvl);break}};e.__onClick=function t(){};e.__moveZoomValue=function t(e){this.zoomValue.style.left=e/100*this.zoomRange.offsetWidth-this.zoomValue.offsetWidth/2+"px"};e.__initZoomChangeWithMouse=function t(e){if(!this.enabled){return}this.prop.mousedown=true;this.__changeZoom(e.clientX)};e.__initZoomChangeByTouch=function t(e){if(!this.enabled){return}this.prop.mousedown=true;this.__changeZoom(e.changedTouches[0].clientX)};e.__zoomIn=function t(){var e=this;if(!this.enabled){return}this.prop.buttondown=true;this.psv.zoomIn();this.prop.longPressTimeout=setTimeout(function(){return e.__startLongPressInterval(1)},200)};e.__zoomOut=function t(){var e=this;if(!this.enabled){return}this.prop.buttondown=true;this.psv.zoomOut();this.prop.longPressTimeout=setTimeout(function(){return e.__startLongPressInterval(-1)},200)};e.__startLongPressInterval=function t(e){var i=this;if(this.prop.buttondown){this.prop.longPressInterval=setInterval(function(){i.psv.zoom(i.psv.prop.zoomLvl+e)},50)}};e.__stopZoomChange=function t(){if(!this.enabled){return}clearInterval(this.prop.longPressInterval);clearTimeout(this.prop.longPressTimeout);this.prop.longPressInterval=null;this.prop.mousedown=false;this.prop.buttondown=false};e.__changeZoomWithMouse=function t(e){if(!this.enabled){return}e.preventDefault();this.__changeZoom(e.clientX)};e.__changeZoomByTouch=function t(e){if(!this.enabled){return}this.__changeZoom(e.changedTouches[0].clientX)};e.__changeZoom=function t(e){if(this.prop.mousedown){var i=e-this.zoomRange.getBoundingClientRect().left;var o=i/this.zoomRange.offsetWidth*100;this.psv.zoom(o)}};return t}(Wt);var qt=function(i){Nt(t,i);Dt(t,null,[{key:"id",get:function t(){return"caption"}},{key:"icon",get:function t(){return"info"}}]);function t(t){var e;e=i.call(this,t,"psv-button--hover-scale psv-caption-button")||this;e.psv.on(K.HIDE_NOTIFICATION,It(It(e)));return e}var e=t.prototype;e.destroy=function t(){this.psv.off(K.HIDE_NOTIFICATION,this);i.prototype.destroy.call(this)};e.handleEvent=function t(e){switch(e.type){case K.HIDE_NOTIFICATION:this.toggleActive(false);break}};e.__onClick=function t(){if(this.psv.notification.visible){this.psv.notification.hide()}else{this.psv.notification.show(this.parent.prop.caption);this.toggleActive(true)}};return t}(Wt);var Qt=function(o){Nt(t,o);function t(t,e){var i;i=o.call(this,t,"psv-caption")||this;i.id="caption";i.prop={caption:"",width:0};i.button=new qt(It(It(i)));i.button.hide();i.content=document.createElement("div");i.content.className="psv-caption-content";i.container.appendChild(i.content);i.psv.on(K.SIZE_UPDATED,It(It(i)));i.setCaption(e);return i}var e=t.prototype;e.destroy=function t(){this.psv.off(K.SIZE_UPDATED,this);this.button.destroy();delete this.button;delete this.content;o.prototype.destroy.call(this)};e.handleEvent=function t(e){switch(e.type){case K.SIZE_UPDATED:this.__onResize();break}};e.setCaption=function t(e){this.prop.caption=e||"";this.content.innerHTML=this.prop.caption;this.button.hide();this.content.style.display="";this.prop.width=this.content.offsetWidth;this.__onResize()};e.__onResize=function t(){if(this.container.offsetWidth>=this.prop.width){this.button.hide();this.content.style.display=""}else{this.button.show();this.content.style.display="none"}};return t}(Ft);var Jt=function(i){Nt(t,i);function t(t){var e;e=i.call(this,t,"psv-navbar")||this;e.items=[];if(e.psv.config.navbar){e.setButtons(e.psv.config.navbar)}return e}var e=t.prototype;e.destroy=function t(){this.setButtons([]);delete this.items;i.prototype.destroy.call(this)};e.setButtons=function t(e){var i=this;this.items.forEach(function(t){return t.destroy()});this.items.length=0;e.forEach(function(t){if(typeof t==="object"){i.items.push(new Yt(i,t))}else{switch(t){case Gt.id:i.items.push(new Gt(i));break;case Kt.id:i.items.push(new Kt(i));break;case Xt.id:i.items.push(new Xt(i));break;case $t.id:i.items.push(new $t(i));break;case Zt.id:i.items.push(new Zt(i));break;case Bt.id:i.items.push(new Bt(i));break;case jt.id:i.items.push(new jt(i));break;case"caption":i.items.push(new Qt(i,i.psv.config.caption));break;default:throw new v("Unknown button "+t)}}})};e.setCaption=function t(e){var i=this.getButton("caption",true);if(!i){throw new v("Cannot set caption, the navbar caption container is not initialized.")}i.setCaption(e)};e.getButton=function t(e,i){var o=null;this.items.some(function(t){if(t.id===e){o=t;return true}else{return false}});if(!o&&!i){D('button "'+e+'" not found in the navbar')}return o};e.show=function t(){this.container.classList.add("psv-navbar--open");this.visible=true};e.hide=function t(){this.container.classList.remove("psv-navbar--open");this.visible=false};return t}(Ft);var te=function(i){Nt(t,i);function t(t){var e;e=i.call(this,t,"psv-notification")||this;e.prop={timeout:null};e.content=document.createElement("div");e.content.className="psv-notification-content";e.container.appendChild(e.content);e.content.addEventListener("click",function(){return e.hide()});return e}var e=t.prototype;e.destroy=function t(){delete this.content;i.prototype.destroy.call(this)};e.show=function t(e){var i=this;if(this.prop.timeout){clearTimeout(this.prop.timeout);this.prop.timeout=null}if(typeof e==="string"){e={content:e}}this.content.innerHTML=e.content;this.visible=true;this.container.classList.add("psv-notification--visible");this.psv.trigger(K.SHOW_NOTIFICATION);if(e.timeout){this.prop.timeout=setTimeout(function(){return i.hide()},e.timeout)}};e.hide=function t(){if(this.visible){this.container.classList.remove("psv-notification--visible");this.visible=false;this.psv.trigger(K.HIDE_NOTIFICATION)}};return t}(Ft);var ee=function(i){Nt(t,i);function t(t){var e;e=i.call(this,t,"psv-overlay")||this;e.prop={id:undefined};e.image=document.createElement("div");e.image.className="psv-overlay-image";e.container.appendChild(e.image);e.text=document.createElement("div");e.text.className="psv-overlay-text";e.container.appendChild(e.text);e.subtext=document.createElement("div");e.subtext.className="psv-overlay-subtext";e.container.appendChild(e.subtext);e.container.addEventListener("mouseup",function(t){t.stopPropagation();e.hide()},true);i.prototype.hide.call(It(e));return e}var e=t.prototype;e.destroy=function t(){delete this.prop;delete this.image;delete this.text;delete this.subtext;i.prototype.destroy.call(this)};e.show=function t(e){if(typeof e==="string"){e={text:e}}this.prop.id=e.id;this.image.innerHTML=e.image||"";this.text.innerHTML=e.text||"";this.subtext.innerHTML=e.subtext||"";i.prototype.show.call(this);this.psv.trigger(K.SHOW_OVERLAY,e.id)};e.hide=function t(e){if(this.visible&&(!e||!this.prop.id||this.prop.id===e)){i.prototype.hide.call(this);this.prop.id=undefined;this.psv.trigger(K.HIDE_OVERLAY)}};return t}(Ft);var ie=200;var oe=function(n){Nt(t,n);function t(t){var e;e=n.call(this,t,"psv-panel")||this;e.prop={id:undefined,mouseX:0,mouseY:0,mousedown:false};var i=document.createElement("div");i.className="psv-panel-resizer";e.container.appendChild(i);var o=document.createElement("div");o.className="psv-panel-close-button";e.container.appendChild(o);e.content=document.createElement("div");e.content.className="psv-panel-content";e.container.appendChild(e.content);e.container.addEventListener(et.mouseWheelEvent,function(t){return t.stopPropagation()});o.addEventListener("click",function(){return e.hide()});i.addEventListener("mousedown",It(It(e)));i.addEventListener("touchstart",It(It(e)));e.psv.container.addEventListener("mouseup",It(It(e)));e.psv.container.addEventListener("touchend",It(It(e)));e.psv.container.addEventListener("mousemove",It(It(e)));e.psv.container.addEventListener("touchmove",It(It(e)));return e}var e=t.prototype;e.destroy=function t(){this.psv.container.removeEventListener("mousemove",this);this.psv.container.removeEventListener("touchmove",this);this.psv.container.removeEventListener("mouseup",this);this.psv.container.removeEventListener("touchend",this);delete this.prop;delete this.content;n.prototype.destroy.call(this)};e.handleEvent=function t(e){switch(e.type){case"mousedown":this.__onMouseDown(e);break;case"touchstart":this.__onTouchStart(e);break;case"mousemove":this.__onMouseMove(e);break;case"touchmove":this.__onTouchMove(e);break;case"mouseup":this.__onMouseUp(e);break;case"touchend":this.__onMouseUp(e);break}};e.show=function t(e){if(typeof e==="string"){e={content:e}}this.prop.id=e.id;this.visible=true;this.content.innerHTML=e.content;this.content.scrollTop=0;this.container.classList.add("psv-panel--open");c(this.content,"psv-panel-content--no-margin",e.noMargin===true);this.psv.trigger(K.OPEN_PANEL,e.id)};e.hide=function t(e){if(this.visible&&(!e||!this.prop.id||this.prop.id===e)){this.visible=false;this.prop.id=undefined;this.content.innerHTML=null;this.container.classList.remove("psv-panel--open");this.psv.trigger(K.CLOSE_PANEL)}};e.__onMouseDown=function t(e){e.stopPropagation();this.__startResize(e)};e.__onTouchStart=function t(e){e.stopPropagation();this.__startResize(e.changedTouches[0])};e.__onMouseUp=function t(e){if(this.prop.mousedown){e.stopPropagation();this.prop.mousedown=false;this.content.classList.remove("psv-panel-content--no-interaction")}};e.__onMouseMove=function t(e){if(this.prop.mousedown){e.stopPropagation();this.__resize(e)}};e.__onTouchMove=function t(e){if(this.prop.mousedown){this.__resize(e.touches[0])}};e.__startResize=function t(e){this.prop.mouseX=e.clientX;this.prop.mouseY=e.clientY;this.prop.mousedown=true;this.content.classList.add("psv-panel-content--no-interaction")};e.__resize=function t(e){var i=e.clientX;var o=e.clientY;this.container.style.width=Math.max(ie,this.container.offsetWidth-(i-this.prop.mouseX))+"px";this.prop.mouseX=i;this.prop.mouseY=o};return t}(Ft);var ne={0:"left",.5:"center",1:"right"};var re={0:"top",.5:"center",1:"bottom"};var se=function(i){Nt(t,i);function t(t){var e;e=i.call(this,t,"psv-tooltip")||this;e.prop={state:null,arrowSize:0,offset:0};e.content=document.createElement("div");e.content.className="psv-tooltip-content";e.container.appendChild(e.content);e.arrow=document.createElement("div");e.arrow.className="psv-tooltip-arrow";e.container.appendChild(e.arrow);e.container.addEventListener("transitionend",It(It(e)));e.container.style.top="-1000px";e.container.style.left="-1000px";e.prop.arrowSize=parseInt(_(e.arrow,"borderTopWidth"),10);e.prop.offset=parseInt(_(e.container,"outlineWidth"),10);e.psv.on(K.RENDER,It(It(e)));return e}var e=t.prototype;e.destroy=function t(){this.psv.off(K.RENDER,this);delete this.arrow;delete this.content;delete this.prop;i.prototype.destroy.call(this)};e.handleEvent=function t(e){switch(e.type){case K.RENDER:this.hide();break;case"transitionend":this.__onTransitionEnd(e);break}};e.show=function t(e){var i=this.visible;var o=this.container;var n=this.content;var r=this.arrow;if(!e.position){e.position=["top","center"]}if(!e.box){e.box={width:0,height:0}}if(typeof e.position==="string"){var s=M(e.position);if(!(s.x in ne)||!(s.y in re)){throw new v('unable to parse tooltip position "'+e.position+'"')}e.position=[re[s.y],ne[s.x]]}if(e.position[0]==="center"&&e.position[1]==="center"){throw new v('unable to parse tooltip position "center center"')}if(i){for(var a=o.classList.length-1;a>=0;a--){var l=o.classList.item(a);if(l!=="psv-tooltip"&&l!=="psv-tooltip--visible"){o.classList.remove(l)}}}else{o.className="psv-tooltip"}if(e.className){p(o,e.className)}n.innerHTML=e.content;o.style.top="0px";o.style.left="0px";var h=o.getBoundingClientRect();var c={posClass:e.position.slice(),width:h.right-h.left,height:h.bottom-h.top,top:0,left:0,arrowTop:0,arrowLeft:0};this.__computeTooltipPosition(c,e);var u=false;if(c.top<this.prop.offset){c.posClass[0]="bottom";u=true}else if(c.top+c.height>this.psv.prop.size.height-this.prop.offset){c.posClass[0]="top";u=true}if(c.left<this.prop.offset){c.posClass[1]="right";u=true}else if(c.left+c.width>this.psv.prop.size.width-this.prop.offset){c.posClass[1]="left";u=true}if(u){this.__computeTooltipPosition(c,e)}o.style.top=c.top+"px";o.style.left=c.left+"px";r.style.top=c.arrowTop+"px";r.style.left=c.arrowLeft+"px";o.classList.add("psv-tooltip--"+c.posClass.join("-"));this.prop.state="showing"};e.hide=function t(){if(this.visible){this.container.classList.remove("psv-tooltip--visible");this.visible=false;this.prop.state="hidding";this.psv.trigger(K.HIDE_TOOLTIP)}};e.__onTransitionEnd=function t(e){if(e.propertyName==="transform"){switch(this.prop.state){case"showing":this.container.classList.add("psv-tooltip--visible");this.visible=true;this.prop.state=null;this.psv.trigger(K.SHOW_TOOLTIP);break;case"hidding":this.prop.state=null;this.content.innerHTML=null;this.container.style.top="-1000px";this.container.style.left="-1000px";break;default:this.prop.state=null}}};e.__computeTooltipPosition=function t(e,i){var o=false;switch(e.posClass[0]){case"bottom":e.top=i.top+i.box.height+this.prop.offset+this.prop.arrowSize;e.arrowTop=-this.prop.arrowSize*2;o=true;break;case"center":e.top=i.top+i.box.height/2-e.height/2;e.arrowTop=e.height/2-this.prop.arrowSize;break;case"top":e.top=i.top-e.height-this.prop.offset-this.prop.arrowSize;e.arrowTop=e.height;o=true;break}switch(e.posClass[1]){case"right":if(o){e.left=i.left+i.box.width/2-this.prop.offset-this.prop.arrowSize;e.arrowLeft=this.prop.offset}else{e.left=i.left+i.box.width+this.prop.offset+this.prop.arrowSize;e.arrowLeft=-this.prop.arrowSize*2}break;case"center":e.left=i.left+i.box.width/2-e.width/2;e.arrowLeft=e.width/2-this.prop.arrowSize;break;case"left":if(o){e.left=i.left-e.width+i.box.width/2+this.prop.offset+this.prop.arrowSize;e.arrowLeft=e.width-this.prop.offset-this.prop.arrowSize*2}else{e.left=i.left-e.width-this.prop.offset-this.prop.arrowSize;e.arrowLeft=e.width}break}};return t}(Ft);var ae=function(){function t(t){this.psv=t;this.config=t.config;this.prop=t.prop}var e=t.prototype;e.destroy=function t(){delete this.psv;delete this.config;delete this.prop};return t}();var le=function(e){Nt(t,e);function t(t){return e.call(this,t)||this}var i=t.prototype;i.fovToZoomLevel=function t(e){var i=Math.round((e-this.config.minFov)/(this.config.maxFov-this.config.minFov)*100);return i-2*(i-50)};i.zoomLevelToFov=function t(e){return this.config.maxFov+e/100*(this.config.minFov-this.config.maxFov)};i.vFovToHFov=function t(e){return f.Math.radToDeg(2*Math.atan(Math.tan(f.Math.degToRad(e)/2)*this.prop.aspect))};i.speedToDuration=function t(e,i){if(!e||typeof e!=="number"){var o=e?C(e):this.config.autorotateSpeed;return i/Math.abs(o)*1e3}else{return Math.abs(e)}};i.textureCoordsToSphericalCoords=function t(e){if(this.prop.isCubemap){throw new v("Unable to use texture coords with cubemap.")}var i=this.prop.panoData;var o=(e.x+i.croppedX)/i.fullWidth*Math.PI*2;var n=(e.y+i.croppedY)/i.fullHeight*Math.PI;return{longitude:o>=Math.PI?o-Math.PI:o+Math.PI,latitude:Math.PI/2-n}};i.sphericalCoordsToTextureCoords=function t(e){if(this.prop.isCubemap){throw new v("Unable to use texture coords with cubemap.")}var i=this.prop.panoData;var o=e.longitude/Math.PI/2*i.fullWidth;var n=e.latitude/Math.PI*i.fullHeight;return{x:Math.round(e.longitude<Math.PI?o+i.fullWidth/2:o-i.fullWidth/2)-i.croppedX,y:Math.round(i.fullHeight/2-n)-i.croppedY}};i.sphericalCoordsToVector3=function t(e){return new f.Vector3(W*-Math.cos(e.latitude)*Math.sin(e.longitude),W*Math.sin(e.latitude),W*Math.cos(e.latitude)*Math.cos(e.longitude))};i.vector3ToSphericalCoords=function t(e){var i=Math.acos(e.y/Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z));var o=Math.atan2(e.x,e.z);return{longitude:o<0?-o:Math.PI*2-o,latitude:Math.PI/2-i}};i.viewerCoordsToVector3=function t(e){var i=new f.Vector2(2*e.x/this.prop.size.width-1,-2*e.y/this.prop.size.height+1);this.psv.renderer.raycaster.setFromCamera(i,this.psv.renderer.camera);var o=this.psv.renderer.raycaster.intersectObjects(this.psv.renderer.scene.children);if(o.length===1){return o[0].point}else{return null}};i.vector3ToViewerCoords=function t(e){var i=e.clone();i.project(this.psv.renderer.camera);return{x:Math.round((i.x+1)/2*this.prop.size.width),y:Math.round((1-i.y)/2*this.prop.size.height)}};i.isExtendedPosition=function t(o){return[["x","y"],["longitude","latitude"]].some(function(t){var e=t[0],i=t[1];return e in o&&i in o})};i.cleanPosition=function t(e){if("x"in e&&"y"in e){return this.textureCoordsToSphericalCoords(e)}else{return{longitude:k(e.longitude),latitude:k(e.latitude,true)}}};i.applyRanges=function t(e){var i={longitude:e.longitude,latitude:e.latitude};var o=[];var n;var r;if(this.config.longitudeRange){n=S(this.config.longitudeRange);r=f.Math.degToRad(this.prop.hFov)/2;n[0]=k(n[0]+r);n[1]=k(n[1]-r);if(n[0]>n[1]){if(e.longitude>n[1]&&e.longitude<n[0]){if(e.longitude>n[0]/2+n[1]/2){i.longitude=n[0];o.push("left")}else{i.longitude=n[1];o.push("right")}}}else if(e.longitude<n[0]){i.longitude=n[0];o.push("left")}else if(e.longitude>n[1]){i.longitude=n[1];o.push("right")}}if(this.config.latitudeRange){n=S(this.config.latitudeRange);r=f.Math.degToRad(this.prop.vFov)/2;n[0]=k(Math.min(n[0]+r,n[1]),true);n[1]=k(Math.max(n[1]-r,n[0]),true);if(e.latitude<n[0]){i.latitude=n[0];o.push("bottom")}else if(e.latitude>n[1]){i.latitude=n[1];o.push("top")}}return{rangedPosition:i,sidesReached:o}};return t}(ae);var he=function(i){Nt(t,i);function t(t){var e;e=i.call(this,t)||this;e.state={keyboardEnabled:false,moving:false,zooming:false,startMouseX:0,startMouseY:0,mouseX:0,mouseY:0,mouseHistory:[],pinchDist:0,dblclickData:null,dblclickTimeout:null};e.__onResize=R(function(){return e.psv.autoSize()},50);return e}var e=t.prototype;e.init=function t(){window.addEventListener("resize",this);window.addEventListener("keydown",this);if(this.config.mousemove){if(this.config.mousemoveHover){this.psv.hud.container.addEventListener("mouseenter",this);this.psv.hud.container.addEventListener("mouseleave",this)}else{this.psv.hud.container.addEventListener("mousedown",this);window.addEventListener("mouseup",this)}this.psv.hud.container.addEventListener("touchstart",this);window.addEventListener("touchend",this);this.psv.hud.container.addEventListener("mousemove",this);this.psv.hud.container.addEventListener("touchmove",this)}if(et.fullscreenEvent){document.addEventListener(et.fullscreenEvent,this)}if(this.config.mousewheel){this.psv.hud.container.addEventListener(et.mouseWheelEvent,this)}};e.destroy=function t(){window.removeEventListener("resize",this);window.removeEventListener("keydown",this);if(this.config.mousemove){this.psv.hud.container.removeEventListener("mousedown",this);this.psv.hud.container.removeEventListener("mouseenter",this);this.psv.hud.container.removeEventListener("touchstart",this);window.removeEventListener("mouseup",this);window.removeEventListener("touchend",this);this.psv.hud.container.removeEventListener("mouseleave",this);this.psv.hud.container.removeEventListener("mousemove",this);this.psv.hud.container.removeEventListener("touchmove",this)}if(et.fullscreenEvent){document.removeEventListener(et.fullscreenEvent,this)}if(this.config.mousewheel){this.psv.hud.container.removeEventListener(et.mouseWheelEvent,this)}delete this.state;i.prototype.destroy.call(this)};e.handleEvent=function t(e){switch(e.type){case"resize":this.__onResize();break;case"keydown":this.__onKeyDown(e);break;case"mousedown":this.__onMouseDown(e);break;case"mouseenter":this.__onMouseDown(e);break;case"touchstart":this.__onTouchStart(e);break;case"mouseup":this.__onMouseUp(e);break;case"mouseleave":this.__onMouseUp(e);break;case"touchend":this.__onTouchEnd(e);break;case"mousemove":this.__onMouseMove(e);break;case"touchmove":this.__onTouchMove(e);break;case et.fullscreenEvent:this.__fullscreenToggled();break;case et.mouseWheelEvent:this.__onMouseWheel(e);break}};e.enableKeyboard=function t(){this.state.keyboardEnabled=true};e.disableKeyboard=function t(){this.state.keyboardEnabled=false};e.__onKeyDown=function t(e){if(!this.state.keyboardEnabled){return}var i=0;var o=0;var n=0;var r=a(e);var s=this.config.keyboard[r];switch(s){case B.ROTATE_LAT_UP:o=.01;break;case B.ROTATE_LAT_DOWN:o=-.01;break;case B.ROTATE_LONG_RIGHT:i=.01;break;case B.ROTATE_LONG_LEFT:i=-.01;break;case B.ZOOM_IN:n=1;break;case B.ZOOM_OUT:n=-1;break;case B.TOGGLE_AUTOROTATE:this.psv.toggleAutorotate();break}if(n!==0){this.psv.zoom(this.prop.zoomLvl+n*this.config.zoomSpeed)}else if(o!==0||i!==0){this.psv.rotate({longitude:this.prop.position.longitude+i*this.prop.moveSpeed*this.prop.hFov,latitude:this.prop.position.latitude+o*this.prop.moveSpeed*this.prop.vFov})}};e.__onMouseDown=function t(e){this.__startMove(e)};e.__onMouseUp=function t(e){this.__stopMove(e);if(this.psv.isStereoEnabled()){this.psv.stopStereoView()}};e.__onMouseMove=function t(e){if(e.buttons!==0){e.preventDefault();this.__move(e)}else if(this.config.mousemoveHover){this.__moveAbsolute(e)}};e.__onTouchStart=function t(e){if(e.touches.length===1){if(!this.config.touchmoveTwoFingers){this.__startMove(e.touches[0]);e.preventDefault()}}else if(e.touches.length===2){this.__startMoveZoom(e);e.preventDefault()}};e.__onTouchEnd=function t(e){if(e.touches.length===1){this.__stopMoveZoom()}else if(e.touches.length===0){this.__stopMove(e.changedTouches[0]);if(this.config.touchmoveTwoFingers){this.psv.overlay.hide(Q.TWO_FINGERS)}}};e.__onTouchMove=function t(e){if(e.touches.length===1){if(this.config.touchmoveTwoFingers){this.psv.overlay.show({id:Q.TWO_FINGERS,image:this.psv.icons.gesture,text:this.config.lang.twoFingers[0]})}else{e.preventDefault();this.__move(e.touches[0])}}else if(e.touches.length===2){e.preventDefault();this.__moveZoom(e)}};e.__onMouseWheel=function t(e){e.preventDefault();e.stopPropagation();var i=P(e).spinY*5;if(i!==0){this.psv.zoom(this.prop.zoomLvl-i*this.config.mousewheelFactor)}};e.__fullscreenToggled=function t(){this.prop.fullscreen=w(this.psv.container);if(this.config.keyboard){if(this.prop.fullscreen){this.psv.startKeyboardControl()}else{this.psv.stopKeyboardControl()}}this.psv.trigger(K.FULLSCREEN_UPDATED,this.prop.fullscreen)};e.__startMove=function t(e){var i=this;this.psv.stopAutorotate();this.psv.stopAnimation().then(function(){i.state.mouseX=e.clientX;i.state.mouseY=e.clientY;i.state.startMouseX=i.state.mouseX;i.state.startMouseY=i.state.mouseY;i.state.moving=true;i.state.zooming=false;i.state.mouseHistory.length=0;i.__logMouseMove(e)})};e.__startMoveZoom=function t(e){var i={x:e.touches[0].clientX,y:e.touches[0].clientY};var o={x:e.touches[1].clientX,y:e.touches[1].clientY};this.state.pinchDist=u(i,o);this.state.mouseX=(i.x+o.x)/2;this.state.mouseY=(i.y+o.y)/2;this.state.startMouseX=this.state.mouseX;this.state.startMouseY=this.state.mouseY;this.state.moving=true;this.state.zooming=true};e.__stopMove=function t(e){if(!r(e.target,".psv-hud")){return}if(this.state.moving){if(Math.abs(e.clientX-this.state.startMouseX)<H&&Math.abs(e.clientY-this.state.startMouseY)<H){this.__click(e);this.state.moving=false}else if(this.config.moveInertia&&!this.psv.isGyroscopeEnabled()){this.__logMouseMove(e);this.__stopMoveInertia(e)}else{this.state.moving=false}this.state.mouseHistory.length=0}};e.__stopMoveZoom=function t(){this.state.mouseHistory.length=0;this.state.moving=false;this.state.zooming=false};e.__stopMoveInertia=function t(e){var i=this;var o={x:e.clientX-this.state.mouseHistory[0][1],y:e.clientY-this.state.mouseHistory[0][2]};var n=Math.sqrt(o.x*o.x+o.y*o.y);this.prop.animationPromise=new Ot({properties:{clientX:{start:e.clientX,end:e.clientX+o.x},clientY:{start:e.clientY,end:e.clientY+o.y}},duration:n*V/100,easing:"outCirc",onTick:function t(e){i.__move(e,false)}}).finally(function(){i.state.moving=false})};e.__click=function t(e){var i=this;var o=this.psv.container.getBoundingClientRect();var n={target:e.target,clientX:e.clientX,clientY:e.clientY,viewerX:e.clientX-o.left,viewerY:e.clientY-o.top};var r=this.psv.dataHelper.viewerCoordsToVector3({x:n.viewerX,y:n.viewerY});if(r){var s=this.psv.dataHelper.vector3ToSphericalCoords(r);n.longitude=s.longitude;n.latitude=s.latitude;if(!this.prop.isCubemap){var a=this.psv.dataHelper.sphericalCoordsToTextureCoords(n);n.textureX=a.x;n.textureY=a.y}if(!this.state.dblclickTimeout){this.psv.trigger(K.CLICK,n);this.state.dblclickData=S(n);this.state.dblclickTimeout=setTimeout(function(){i.state.dblclickTimeout=null;i.state.dblclickData=null},U)}else{if(Math.abs(this.state.dblclickData.clientX-n.clientX)<H&&Math.abs(this.state.dblclickData.clientY-n.clientY)<H){this.psv.trigger(K.DOUBLE_CLICK,this.state.dblclickData)}clearTimeout(this.state.dblclickTimeout);this.state.dblclickTimeout=null;this.state.dblclickData=null}}};e.__move=function t(e,i){if(this.state.moving){var o=e.clientX;var n=e.clientY;var r={longitude:(o-this.state.mouseX)/this.prop.size.width*this.prop.moveSpeed*this.prop.hFov*et.pixelRatio,latitude:(n-this.state.mouseY)/this.prop.size.height*this.prop.moveSpeed*this.prop.vFov*et.pixelRatio};if(this.psv.isGyroscopeEnabled()){this.prop.gyroAlphaOffset+=r.longitude}else{this.psv.rotate({longitude:this.prop.position.longitude-r.longitude,latitude:this.prop.position.latitude+r.latitude})}this.state.mouseX=o;this.state.mouseY=n;if(i!==false){this.__logMouseMove(e)}}};e.__moveAbsolute=function t(e){if(this.state.moving){this.psv.rotate({longitude:((e.clientX-this.psv.container.offsetLeft)/this.psv.container.offsetWidth-.5)*Math.PI*2,latitude:-((e.clientY-this.psv.container.offsetTop)/this.psv.container.offsetHeight-.5)*Math.PI})}};e.__moveZoom=function t(e){if(this.state.zooming&&this.state.moving){var i={x:e.touches[0].clientX,y:e.touches[0].clientY};var o={x:e.touches[1].clientX,y:e.touches[1].clientY};var n=u(i,o);var r=80*(n-this.state.pinchDist)/this.prop.size.width;this.psv.zoom(this.prop.zoomLvl+r);this.__move({clientX:(i.x+o.x)/2,clientY:(i.y+o.y)/2});this.state.pinchDist=n}};e.__logMouseMove=function t(e){var i=Date.now();this.state.mouseHistory.push([i,e.clientX,e.clientY]);var o=null;for(var n=0;n<this.state.mouseHistory.length;){if(this.state.mouseHistory[0][n]<i-V){this.state.mouseHistory.splice(n,1)}else if(o&&this.state.mouseHistory[0][n]-o>V/10){this.state.mouseHistory.splice(0,n);n=0;o=this.state.mouseHistory[0][n]}else{n++;o=this.state.mouseHistory[0][n]}}};return t}(ae);var ce=function(i){Nt(t,i);function t(t){var e;e=i.call(this,t)||this;e.mainReqid=undefined;e.canvasContainer=null;e.renderer=null;e.stereoEffect=null;e.scene=null;e.camera=null;e.mesh=null;e.raycaster=null;e.doControls=null;t.on(K.SIZE_UPDATED,function(t){if(e.renderer){(e.stereoEffect||e.renderer).setSize(t.width,t.height)}});return e}var e=t.prototype;e.destroy=function t(){if(this.mainReqid){window.cancelAnimationFrame(this.mainReqid)}if(this.scene){x(this.scene)}if(this.doControls){this.doControls.disconnect()}if(this.canvasContainer){this.psv.container.removeChild(this.canvasContainer)}delete this.canvasContainer;delete this.renderer;delete this.stereoEffect;delete this.scene;delete this.camera;delete this.mesh;delete this.raycaster;delete this.doControls;i.prototype.destroy.call(this)};e.hide=function t(){if(this.canvasContainer){this.canvasContainer.style.opacity=0}};e.show=function t(){if(this.canvasContainer){this.canvasContainer.style.opacity=1}};e.__renderLoop=function t(e){var i=this;this.psv.trigger(K.BEFORE_RENDER,e);if(this.prop.needsUpdate){this.render();this.prop.needsUpdate=false}this.mainReqid=window.requestAnimationFrame(function(t){return i.__renderLoop(t)})};e.render=function t(){this.prop.direction=this.psv.dataHelper.sphericalCoordsToVector3(this.prop.position);this.camera.position.set(0,0,0);this.camera.lookAt(this.prop.direction);if(this.config.fisheye){this.camera.position.copy(this.prop.direction).multiplyScalar(this.config.fisheye/2).negate()}this.camera.aspect=this.prop.aspect;this.camera.fov=this.prop.vFov;this.camera.updateProjectionMatrix();(this.stereoEffect||this.renderer).render(this.scene,this.camera);this.psv.trigger(K.RENDER)};e.setTexture=function t(e){var i=e.texture,o=e.panoData;this.prop.panoData=o;if(!this.scene){this.__createScene()}if(this.prop.isCubemap){for(var n=0;n<6;n++){if(this.mesh.material[n].map){this.mesh.material[n].map.dispose()}this.mesh.material[n].map=i[n]}}else{if(this.mesh.material.map){this.mesh.material.map.dispose()}this.mesh.material.map=i}this.psv.trigger(K.PANORAMA_LOADED);if(!this.mainReqid){this.__renderLoop(+new Date)}};e.__createScene=function t(){this.raycaster=new f.Raycaster;this.renderer=et.isWebGLSupported&&this.config.webgl?new f.WebGLRenderer:new f.CanvasRenderer;this.renderer.setSize(this.prop.size.width,this.prop.size.height);this.renderer.setPixelRatio(et.pixelRatio);var e=W;if(this.prop.isCubemap){e*=Math.sqrt(3)}if(this.config.fisheye){e+=W}this.camera=new f.PerspectiveCamera(this.config.defaultFov,this.prop.size.width/this.prop.size.height,1,e);this.camera.position.set(0,0,0);if(et.checkTHREE("DeviceOrientationControls")){this.doControls=new f.DeviceOrientationControls(this.camera)}this.scene=new f.Scene;this.scene.add(this.camera);if(this.prop.isCubemap){this.mesh=this.__createCubemap()}else{this.mesh=this.__createSphere()}this.scene.add(this.mesh);this.canvasContainer=document.createElement("div");this.canvasContainer.className="psv-canvas-container";this.renderer.domElement.className="psv-canvas";this.psv.container.appendChild(this.canvasContainer);this.canvasContainer.appendChild(this.renderer.domElement);this.hide()};e.__createSphere=function t(e){if(e===void 0){e=1}var i=new f.SphereGeometry(W*e,G,G,-Math.PI/2);var o=new f.MeshBasicMaterial({side:f.DoubleSide,overdraw:et.isWebGLSupported&&this.config.webgl?0:1});var n=new f.Mesh(i,o);n.scale.x=-1;n.rotation.x=this.config.sphereCorrection.tilt;n.rotation.y=this.config.sphereCorrection.pan;n.rotation.z=this.config.sphereCorrection.roll;return n};e.__createCubemap=function t(e){if(e===void 0){e=1}var i=W*2*e;var o=new f.BoxGeometry(i,i,i,Y,Y,Y);var n=[];for(var r=0;r<6;r++){n.push(new f.MeshBasicMaterial({side:f.BackSide,overdraw:et.isWebGLSupported&&this.config.webgl?0:1}))}var s=new f.Mesh(o,n);s.position.x-=W*e;s.position.y-=W*e;s.position.z-=W*e;s.applyMatrix((new f.Matrix4).makeScale(1,1,-1));return s};e.transition=function t(e,i){var o=this;var n=e.texture;var r=this.psv.dataHelper.isExtendedPosition(i);var s="zoom"in i;var a;if(this.prop.isCubemap){if(r){D("cannot perform cubemap transition to different position");r=false}a=this.__createCubemap(.9);a.material.forEach(function(t,e){t.map=n[e];t.transparent=true;t.opacity=0})}else{a=this.__createSphere(.9);a.material.map=n;a.material.transparent=true;a.material.opacity=0}if(r){var l=this.psv.dataHelper.cleanPosition(i);a.rotateY(l.longitude-this.prop.position.longitude);var h=new f.Vector3(0,1,0).cross(this.camera.getWorldDirection(new f.Vector3)).normalize();var c=(new f.Quaternion).setFromAxisAngle(h,l.latitude-this.prop.position.latitude);a.quaternion.multiplyQuaternions(c,a.quaternion);if(this.config.latitudeRange||this.config.longitudeRange){this.config.longitudeRange=null;this.config.latitudeRange=null;D("trying to perform transition with longitudeRange and/or latitudeRange, ranges cleared")}}this.scene.add(a);this.psv.needsUpdate();return new Ot({properties:{opacity:{start:0,end:1},zoom:s?{start:this.prop.zoomLvl,end:i.zoom}:undefined},duration:this.config.transitionDuration,easing:"outCubic",onTick:function t(e){if(o.prop.isCubemap){for(var i=0;i<6;i++){a.material[i].opacity=e.opacity}}else{a.material.opacity=e.opacity}if(s){o.psv.zoom(e.zoom)}o.psv.needsUpdate()}}).then(function(){o.setTexture(e);o.scene.remove(a);a.geometry.dispose();a.geometry=null;if(r){o.psv.rotate(i)}})};e.reverseAutorotate=function t(){var i=this;if(!this.psv.isAutorotateEnabled()){return}var e=-this.config.autorotateSpeed;var o=this.config.longitudeRange;this.config.longitudeRange=null;new Ot({properties:{speed:{start:this.config.autorotateSpeed,end:0}},duration:300,easing:"inSine",onTick:function t(e){i.config.autorotateSpeed=e.speed}}).then(function(){return new Ot({properties:{speed:{start:0,end:e}},duration:300,easing:"outSine",onTick:function t(e){i.config.autorotateSpeed=e.speed}})}).then(function(){i.config.longitudeRange=o;i.config.autorotateSpeed=e})};e.startGyroscopeControl=function t(){var e=this;this.doControls.alphaOffset=0;this.doControls.update();var i=this.camera.getWorldDirection(new f.Vector3);var o=this.psv.dataHelper.vector3ToSphericalCoords(i);this.prop.gyroAlphaOffset=E(this.prop.position.longitude,o.longitude);this.prop.orientationCb=function(){e.doControls.alphaOffset=e.prop.gyroAlphaOffset;e.doControls.update();e.camera.getWorldDirection(e.prop.direction);e.prop.direction.multiplyScalar(W);var t=e.psv.dataHelper.vector3ToSphericalCoords(e.prop.direction);e.prop.position.longitude=t.longitude;e.prop.position.latitude=t.latitude;e.psv.needsUpdate()};this.psv.on(K.BEFORE_RENDER,this.prop.orientationCb)};e.stopGyroscopeControl=function t(){this.psv.off(K.BEFORE_RENDER,this.prop.orientationCb);this.prop.orientationCb=null};e.startStereoView=function t(){this.stereoEffect=new f.StereoEffect(this.renderer)};e.stopStereoView=function t(){this.stereoEffect=null};return t}(ae);var ue=function(i){Nt(t,i);function t(t){var e;e=i.call(this,t)||this;e.cache=[];return e}var e=t.prototype;e.destroy=function t(){this.cache.length=0;i.prototype.destroy.call(this)};e.loadTexture=function t(i){var o=[];if(Array.isArray(i)){if(i.length!==6){throw new v("Must provide exactly 6 image paths when using cubemap.")}for(var e=0;e<6;e++){o[e]=i[X[e]]}return this.__loadCubemapTexture(o)}else if(typeof i==="object"){if(!Z.every(function(t){return!!i[t]})){throw new v("Must provide exactly left, front, right, back, top, bottom when using cubemap.")}Z.forEach(function(t,e){o[e]=i[t]});return this.__loadCubemapTexture(o)}else{return this.__loadEquirectangularTexture(i)}};e.__loadEquirectangularTexture=function t(u){var p=this;if(this.prop.isCubemap===true){throw new v("The viewer was initialized with an cubemap, cannot switch to equirectangular panorama.")}this.prop.isCubemap=false;if(this.config.cacheTexture){var e=this.getPanoramaCache(u);if(e){this.prop.panodata=e.panoData;return Promise.resolve({texture:e.image,panoData:e.panoData})}}return this.__loadXMP(u).then(function(c){return new Promise(function(l,i){var t=new f.ImageLoader;var h=c?100:0;if(p.config.withCredentials){t.setCrossOrigin("use-credentials")}else{t.setCrossOrigin("anonymous")}var e=function t(e){h=100;p.psv.loader.setProgress(h);p.psv.trigger(K.PANORAMA_LOAD_PROGRESS,u,h);var i=c||{fullWidth:e.width,fullHeight:e.height,croppedWidth:e.width,croppedHeight:e.height,croppedX:0,croppedY:0};var o;var n=Math.min(i.fullWidth,et.maxTextureWidth)/i.fullWidth;if(n!==1||i.croppedWidth!==i.fullWidth||i.croppedHeight!==i.fullHeight){var r=S(i);r.fullWidth*=n;r.fullHeight*=n;r.croppedWidth*=n;r.croppedHeight*=n;r.croppedX*=n;r.croppedY*=n;e.width=r.croppedWidth;e.height=r.croppedHeight;var s=document.createElement("canvas");s.width=r.fullWidth;s.height=r.fullHeight;var a=s.getContext("2d");a.drawImage(e,r.croppedX,r.croppedY,r.croppedWidth,r.croppedHeight);o=new f.Texture(s)}else{o=new f.Texture(e)}o.needsUpdate=true;o.minFilter=f.LinearFilter;o.generateMipmaps=false;if(p.config.cacheTexture){p.__putPanoramaCache({panorama:u,image:o,panoData:S(i)})}l({texture:o,panoData:i})};var o=function t(e){if(e.lengthComputable){var i=e.loaded/e.total*100;if(i>h){h=i;p.psv.loader.setProgress(h);p.psv.trigger(K.PANORAMA_LOAD_PROGRESS,u,h)}}};var n=function t(e){p.psv.showError("Cannot load image");i(e)};t.load(u,e,o,n)})})};e.__loadCubemapTexture=function t(p){var d=this;if(this.prop.isCubemap===false){throw new v("The viewer was initialized with an equirectangular panorama, cannot switch to cubemap.")}if(this.config.fisheye){D("fisheye effect with cubemap texture can generate distorsion")}if(this.config.cacheTexture===pt.cacheTexture){this.config.cacheTexture*=6}this.prop.isCubemap=true;return new Promise(function(e,o){var t=new f.ImageLoader;var s=[0,0,0,0,0,0];var a=[];var l=0;if(d.config.withCredentials){t.setCrossOrigin("use-credentials")}else{t.setCrossOrigin("anonymous")}var h=function t(){a.forEach(function(t){t.needsUpdate=true;t.minFilter=f.LinearFilter;t.generateMipmaps=false});e({texture:a})};var i=function t(e,i){l++;s[e]=100;d.psv.loader.setProgress(g(s)/6);d.psv.trigger(K.PANORAMA_LOAD_PROGRESS,p[e],s[e]);var o=Math.min(i.width,et.maxTextureWidth/2)/i.width;if(o!==1){var n=document.createElement("canvas");n.width=i.width*o;n.height=i.height*o;var r=n.getContext("2d");r.drawImage(i,0,0,n.width,n.height);a[e]=new f.Texture(n)}else{a[e]=new f.Texture(i)}if(d.config.cacheTexture){d.__putPanoramaCache({panorama:p[e],image:a[e]})}if(l===6){h()}};var n=function t(e,i){if(i.lengthComputable){var o=i.loaded/i.total*100;if(o>s[e]){s[e]=o;d.psv.loader.setProgress(g(s)/6);d.psv.trigger(K.PANORAMA_LOAD_PROGRESS,p[e],s[e])}}};var r=function t(e,i){d.psv.showError("Cannot load image");o(i)};for(var c=0;c<6;c++){if(d.config.cacheTexture){var u=d.getPanoramaCache(p[c]);if(u){l++;s[c]=100;a[c]=u.image}}if(!a[c]){t.load(p[c],i.bind(d,c),n.bind(d,c),r.bind(d,c))}}if(l===6){e({texture:a})}})};e.__loadXMP=function t(e){var h=this;if(!this.config.useXmpData){return Promise.resolve(null)}return new Promise(function(r,s){var a=0;var l=new XMLHttpRequest;if(h.config.withCredentials){l.withCredentials=true}l.onreadystatechange=function(){if(l.readyState===4){if(l.status===200||l.status===201||l.status===202||l.status===0){h.psv.loader.setProgress(100);var t=l.responseText;var e=t.indexOf("<x:xmpmeta");var i=t.indexOf("</x:xmpmeta>");var o=t.substring(e,i);var n=null;if(e!==-1&&i!==-1&&o.indexOf("GPano:")!==-1){n={fullWidth:parseInt(m(o,"FullPanoWidthPixels"),10),fullHeight:parseInt(m(o,"FullPanoHeightPixels"),10),croppedWidth:parseInt(m(o,"CroppedAreaImageWidthPixels"),10),croppedHeight:parseInt(m(o,"CroppedAreaImageHeightPixels"),10),croppedX:parseInt(m(o,"CroppedAreaLeftPixels"),10),croppedY:parseInt(m(o,"CroppedAreaTopPixels"),10)};if(!n.fullWidth||!n.fullHeight||!n.croppedWidth||!n.croppedHeight){D("invalid XMP data");n=null}}r(n)}else{h.psv.showError("Cannot load image");s()}}else if(l.readyState===3){h.psv.loader.setProgress(a+=10)}};l.onprogress=function(t){if(t.lengthComputable){var e=t.loaded/t.total*100;if(e>a){a=e;h.psv.loader.setProgress(a)}}};l.onerror=function(t){h.psv.showError("Cannot load image");s(t)};l.open("GET",e,true);l.send(null)})};e.preloadPanorama=function t(e){if(!this.config.cacheTexture){throw new v("Cannot preload panorama, cacheTexture is disabled")}return this.loadTexture(e)};e.clearPanoramaCache=function t(e){if(!this.config.cacheTexture){throw new v("Cannot clear cache, cacheTexture is disabled")}if(e){for(var i=0,o=this.cache.length;i<o;i++){if(this.cache[i].panorama===e){this.cache.splice(i,1);break}}}else{this.cache.length=0}};e.getPanoramaCache=function t(e){if(!this.config.cacheTexture){throw new v("Cannot query cache, cacheTexture is disabled")}return this.cache.filter(function(t){return t.panorama===e}).shift()};e.__putPanoramaCache=function t(e){if(!this.config.cacheTexture){throw new v("Cannot add panorama to cache, cacheTexture is disabled")}var i=this.getPanoramaCache(e.panorama);if(i){i.image=e.image;i.panoData=e.panoData}else{this.cache.splice(0,1);this.cache.push(e)}this.psv.trigger(K.PANORAMA_CACHED,e.panorama)};return t}(ae);var pe=function(){function i(t){var e=this;if(!(this instanceof i)){return new i(t)}et.load();this.prop={ready:false,needsUpdate:false,fullscreen:false,isCubemap:undefined,position:{longitude:0,latitude:0},direction:null,zoomLvl:0,vFov:0,hFov:0,aspect:0,moveSpeed:.1,gyroAlphaOffset:0,orientationCb:null,autorotateCb:null,animationPromise:null,loadingPromise:null,startTimeout:null,size:{width:0,height:0},panoData:{fullWidth:0,fullHeight:0,croppedWidth:0,croppedHeight:0,croppedX:0,croppedY:0},noSleep:null};this.config=dt(t);this.parent=typeof t.container==="string"?document.getElementById(t.container):t.container;this.parent[$]=this;this.container=document.createElement("div");this.container.classList.add("psv-container");this.parent.appendChild(this.container);this.templates=gt(t.templates);this.icons=Pt(t.icons);this.renderer=new ce(this);this.textureLoader=new ue(this);this.eventsHandler=new he(this);this.dataHelper=new le(this);this.loader=new Vt(this);this.navbar=new Jt(this);this.hud=new Ut(this);this.panel=new oe(this);this.tooltip=new se(this.hud);this.notification=new te(this);this.overlay=new ee(this);this.eventsHandler.init();this.resize(this.config.size);this.zoom(this.config.defaultZoomLvl);this.prop.moveSpeed=f.Math.degToRad(this.config.moveSpeed/et.pixelRatio);this.rotate({longitude:this.config.defaultLong,latitude:this.config.defaultLat});if(this.config.panorama){this.setPanorama(this.config.panorama)}this.once("render",function(){if(e.config.navbar){e.container.classList.add("psv--has-navbar");e.navbar.show()}e.hud.show();if(e.config.markers){e.hud.setMarkers(e.config.markers)}if(e.config.autorotateStartup){e.prop.startTimeout=setTimeout(function(){return e.startAutorotate()},e.config.autorotateDelay)}e.prop.ready=true;setTimeout(function(){e.trigger(K.READY)},0)});et.isTouchEnabled.then(function(t){return c(e.container,"psv--is-touch",t)})}var t=i.prototype;t.destroy=function t(){this.__stopAll();this.stopKeyboardControl();this.stopNoSleep();this.exitFullscreen();this.unlockOrientation();this.eventsHandler.destroy();this.renderer.destroy();this.textureLoader.destroy();this.dataHelper.destroy();this.loader.destroy();this.navbar.destroy();this.tooltip.destroy();this.notification.destroy();this.hud.destroy();this.panel.destroy();this.overlay.destroy();this.parent.removeChild(this.container);delete this.parent[$];delete this.parent;delete this.container;delete this.loader;delete this.navbar;delete this.hud;delete this.panel;delete this.tooltip;delete this.notification;delete this.overlay;delete this.config;delete this.templates;delete this.icons};t.getPosition=function t(){return{longitude:this.prop.position.longitude,latitude:this.prop.position.latitude}};t.getZoomLevel=function t(){return this.prop.zoomLvl};t.getSize=function t(){return{width:this.prop.size.width,height:this.prop.size.height}};t.isAutorotateEnabled=function t(){return!!this.prop.autorotateCb};t.isGyroscopeEnabled=function t(){return!!this.prop.orientationCb};t.isStereoEnabled=function t(){return!!this.renderer.stereoEffect};t.isFullscreenEnabled=function t(){if(et.fullscreenEvent){return w(this.container)}else{return this.prop.fullscreen}};t.needsUpdate=function t(){this.prop.needsUpdate=true};t.autoSize=function t(){if(this.container.clientWidth!==this.prop.size.width||this.container.clientHeight!==this.prop.size.height){this.prop.size.width=Math.round(this.container.clientWidth);this.prop.size.height=Math.round(this.container.clientHeight);this.prop.aspect=this.prop.size.width/this.prop.size.height;this.needsUpdate();this.trigger(K.SIZE_UPDATED,this.getSize())}};t.setPanorama=function t(e,i,o){var n=this;if(i===void 0){i={}}if(o===void 0){o=true}if(this.prop.loadingPromise!==null){return Promise.reject(new v("Loading already in progress"))}if(typeof i==="boolean"){o=i;i={}}var r=this.dataHelper.isExtendedPosition(i);var s="zoom"in i;if(r||s){this.__stopAll()}this.hideError();this.config.panorama=e;var a=function t(){n.loader.hide();n.renderer.show();n.prop.loadingPromise=null};if(!o||!this.config.transitionDuration||!this.prop.ready){this.loader.show();this.renderer.hide();this.prop.loadingPromise=this.textureLoader.loadTexture(this.config.panorama).then(function(t){n.renderer.setTexture(t);if(r){n.rotate(i)}if(s){n.zoom(i.zoom)}}).catch(function(t){return console.error(t)}).then(a,a)}else{if(this.config.transitionLoader){this.loader.show()}this.prop.loadingPromise=this.textureLoader.loadTexture(this.config.panorama).then(function(t){n.loader.hide();return n.renderer.transition(t,i)}).catch(function(t){return console.error(t)}).then(a,a)}return this.prop.loadingPromise};t.startAutorotate=function t(){var o=this;this.__stopAll();this.prop.autorotateCb=function(){var e;var i;return function(t){i=e===undefined?0:t-e;e=t;o.rotate({longitude:o.prop.position.longitude+o.config.animSpeed*i/1e3,latitude:o.prop.position.latitude-(o.prop.position.latitude-o.config.autorotateLat)/200})}}();this.on(K.BEFORE_RENDER,this.prop.autorotateCb);this.trigger(K.AUTOROTATE,true)};t.stopAutorotate=function t(){if(this.prop.startTimeout){clearTimeout(this.prop.startTimeout);this.prop.startTimeout=null}if(this.isAutorotateEnabled()){this.off(K.BEFORE_RENDER,this.prop.autorotateCb);this.prop.autorotateCb=null;this.trigger(K.AUTOROTATE,false)}};t.toggleAutorotate=function t(){if(this.isAutorotateEnabled()){this.stopAutorotate()}else{this.startAutorotate()}};t.startGyroscopeControl=function t(){var e=this;if(et.checkTHREE("DeviceOrientationControls")){return et.isDeviceOrientationSupported.then(function(t){if(t){e.__stopAll();e.renderer.startGyroscopeControl();e.trigger(K.GYROSCOPE_UPDATED,true);return true}else{D("gyroscope not available");return Promise.reject()}})}else{throw new v("Missing Three.js components: DeviceOrientationControls.")}};t.stopGyroscopeControl=function t(){if(this.isGyroscopeEnabled()){this.renderer.stopGyroscopeControl();this.trigger(K.GYROSCOPE_UPDATED,false)}};t.toggleGyroscopeControl=function t(){if(this.isGyroscopeEnabled()){this.stopGyroscopeControl()}else{this.startGyroscopeControl()}};t.startNoSleep=function t(){if(!("NoSleep"in window)){D("NoSleep is not available");return}if(!this.prop.noSleep){this.prop.noSleep=new window.NoSleep}this.prop.noSleep.enable()};t.stopNoSleep=function t(){if(this.prop.noSleep){this.prop.noSleep.disable()}};t.startStereoView=function t(){var e=this;if(et.checkTHREE("DeviceOrientationControls","StereoEffect")){this.startNoSleep();this.enterFullscreen();this.lockOrientation();this.startGyroscopeControl().then(function(){e.renderer.startStereoView();e.needsUpdate();e.hud.hide();e.navbar.hide();e.panel.hide();e.trigger(K.STEREO_UPATED,true);e.notification.show({content:e.config.lang.stereoNotification,timeout:3e3})},function(){e.unlockOrientation();e.exitFullscreen();e.stopNoSleep()})}else{throw new v("Missing Three.js components: StereoEffect, DeviceOrientationControls.")}};t.stopStereoView=function t(){if(this.isStereoEnabled()){this.renderer.stopStereoView();this.needsUpdate();this.hud.show();this.navbar.show();this.unlockOrientation();this.exitFullscreen();this.stopNoSleep();this.stopGyroscopeControl();this.trigger(K.STEREO_UPATED,false)}};t.toggleStereoView=function t(){if(this.isStereoEnabled()){this.stopStereoView()}else{this.startStereoView()}};t.showError=function t(e){this.overlay.show({id:Q.ERROR,image:this.icons.error,text:e})};t.hideError=function t(){this.overlay.hide(Q.ERROR)};t.lockOrientation=function t(){var e=this;var i;var o=function t(){if(e.isStereoEnabled()&&window.innerHeight>window.innerWidth){e.overlay.show({id:Q.PLEASE_ROTATE,image:e.icons.mobileRotate,text:e.config.lang.pleaseRotate[0],subtext:e.config.lang.pleaseRotate[1]})}if(i){clearTimeout(i);i=null}};if(window.screen&&window.screen.orientation){window.screen.orientation.lock("landscape").then(null,function(){return o()});i=setTimeout(function(){return o()},500)}else{o()}};t.unlockOrientation=function t(){if(window.screen&&window.screen.orientation){window.screen.orientation.unlock()}else{this.overlay.hide(Q.PLEASE_ROTATE)}};t.rotate=function t(e,i){if(i===void 0){i=false}var o=this.dataHelper.cleanPosition(e);if(!i){var n=this.dataHelper.applyRanges(o),r=n.rangedPosition,s=n.sidesReached;if(z(["left","right"],s).length>0){this.renderer.reverseAutorotate()}this.prop.position.longitude=r.longitude;this.prop.position.latitude=r.latitude}else{this.prop.position.longitude=o.longitude;this.prop.position.latitude=o.latitude}this.needsUpdate();this.trigger(K.POSITION_UPDATED,this.getPosition())};t.animate=function t(e,i){var o=this;this.__stopAll();var n=this.dataHelper.isExtendedPosition(e);var r="zoom"in e;var s={};var a;if(n){var l=this.dataHelper.cleanPosition(e);var h=this.dataHelper.applyRanges(l),c=h.rangedPosition;var u=this.prop.position;var p=Math.abs(c.longitude-u.longitude);var d=Math.abs(c.latitude-u.latitude);if(p>=F||d>=F){var f=E(u.longitude,c.longitude);s.longitude={start:u.longitude,end:u.longitude+f};s.latitude={start:u.latitude,end:c.latitude};a=this.dataHelper.speedToDuration(i,b(u,c))}}if(r){var v=Math.abs(e.zoom-this.prop.zoomLvl);if(v>=1){s.zoom={start:this.prop.zoomLvl,end:e.zoom};if(!a){a=this.dataHelper.speedToDuration(i,Math.PI/4*v/100)}}}if(!a){if(n){this.rotate(e)}if(r){this.zoom(e.zoom)}return Ot.resolve()}this.prop.animationPromise=new Ot({properties:s,duration:a,easing:"inOutSine",onTick:function t(e){if(n){o.rotate(e,true)}if(r){o.zoom(e.zoom)}}});return this.prop.animationPromise};t.stopAnimation=function t(){var e=this;if(this.prop.animationPromise){return new Promise(function(t){e.prop.animationPromise.finally(t);e.prop.animationPromise.cancel();e.prop.animationPromise=null})}else{return Promise.resolve()}};t.zoom=function t(e){this.prop.zoomLvl=l(e,0,100);this.prop.vFov=this.dataHelper.zoomLevelToFov(this.prop.zoomLvl);this.prop.hFov=this.dataHelper.vFovToHFov(this.prop.vFov);this.needsUpdate();this.trigger(K.ZOOM_UPDATED,this.getZoomLevel())};t.zoomIn=function t(){if(this.prop.zoomLvl<100){this.zoom(this.prop.zoomLvl+this.config.zoomSpeed)}};t.zoomOut=function t(){if(this.prop.zoomLvl>0){this.zoom(this.prop.zoomLvl-this.config.zoomSpeed)}};t.resize=function t(e){var i=this;["width","height"].forEach(function(t){if(e&&e[t]){if(/^[0-9.]+$/.test(e[t])){e[t]+="px"}i.parent.style[t]=e[t]}});this.autoSize()};t.enterFullscreen=function t(){if(et.fullscreenEvent){e(this.container)}else{this.container.classList.add("psv-container--fullscreen");this.prop.fullscreen=true;this.autoSize()}};t.exitFullscreen=function t(){if(et.fullscreenEvent){y()}else{this.container.classList.remove("psv-container--fullscreen");this.prop.fullscreen=false;this.autoSize()}};t.toggleFullscreen=function t(){if(!this.isFullscreenEnabled()){this.enterFullscreen()}else{this.exitFullscreen()}};t.startKeyboardControl=function t(){this.eventsHandler.enableKeyboard()};t.stopKeyboardControl=function t(){this.eventsHandler.disableKeyboard()};t.__stopAll=function t(){this.stopAutorotate();this.stopAnimation();this.stopGyroscopeControl();this.stopStereoView()};t.toggleMarkersList=function t(){if(this.panel.prop.id===Q.MARKERS_LIST){this.hideMarkersList()}else{this.showMarkersList()}};t.showMarkersList=function t(){var n=this;var e=[];O(this.hud.markers,function(t){if(t.visible&&!t.config.hideList){e.push(t)}});e=this.change(K.RENDER_MARKERS_LIST,e);this.panel.show({id:Q.MARKERS_LIST,content:this.templates.markersList(e,this),noMargin:true});var i=this.panel.container.querySelector(".psv-markers-list");i.addEventListener("click",function(t){var e=t.target?r(t.target,"li"):undefined;var i=e?e.dataset[j]:undefined;if(i){var o=n.hud.getMarker(i);n.trigger(K.SELECT_MARKER_LIST,o);n.hud.gotoMarker(o,1e3);n.hideMarkersList()}})};t.hideMarkersList=function t(){this.panel.hide(Q.MARKERS_LIST)};return i}();pe.Utils=N;pe.CONSTANTS=tt;pe.DEFAULTS=pt;pe.TEMPLATES=vt;pe.ICONS=St;pe.SYSTEM=et;pe.PSVError=v;pe.PSVAnimation=Ot;t.mixin(pe);return pe});